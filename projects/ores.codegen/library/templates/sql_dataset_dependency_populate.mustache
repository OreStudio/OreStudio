{{! Template to generate SQL with enhanced GPL v3 license and dataset dependency data }}
{{{sql_license}}}

-- =============================================================================
-- Data Quality Slovaris Dataset Dependencies
-- =============================================================================

\echo '--- Data Quality Slovaris Dataset Dependencies ---'

{{#datasets}}
{{#dataset_dependencies}}
select ores_dq_dataset_dependencies_upsert_fn(ores_iam_system_tenant_id_fn(),
    '{{parent_code}}',
    '{{dependency_code}}',
    '{{role}}'
);
{{/dataset_dependencies}}
{{/datasets}}

-- =============================================================================
-- Summary
-- =============================================================================

\echo ''
\echo '--- Summary ---'

select dataset_code, dependency_code, role
from ores_dq_dataset_dependencies_tbl
where valid_to = ores_utility_infinity_timestamp_fn()
  and dataset_code like 'slovaris.%'
order by dataset_code, dependency_code;
