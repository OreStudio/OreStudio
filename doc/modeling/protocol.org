:PROPERTIES:
:ID: A7B3C9D2-E5F1-4A8B-9C6D-3E2F1A0B8C7D
:END:
#+title: ORE Studio Binary Protocol Reference
#+author: Auto-generated by generate_protocol_docs.py
#+options: <:nil c:nil todo:nil ^:nil d:nil date:nil author:nil toc:t html-postamble:nil
#+startup: overview

This document provides a comprehensive reference for the ORE Studio binary
protocol. It is auto-generated from the C++ header files and should be
regenerated whenever protocol changes are made.

* Protocol Version

Current version: *8.0*

Version history:

- Protocol version 7 adds correlation_id field to frame header for
- request/response matching, enabling concurrent operations and server-push
- notifications.
- Version 7.1 adds subscription protocol messages (subscribe_request,
- subscribe_response, unsubscribe_request, unsubscribe_response, notification)
- for server-push event notifications.
- Version 8.0 removes requester_account_id from lock_account_request and
- unlock_account_request. Authorization is now handled via server-side session
- tracking instead of client-provided identity. This is a breaking change.

* Core Subsystem (0x0000-0x0FFF)

** Messages Overview

| ID | Name | Description |
|----+------+-------------|
| 0x0001 | handshake_request | Handshake request message sent by client to initia... |
| 0x0002 | handshake_response | Handshake response message sent by server to clien... |
| 0x0003 | handshake_ack | Handshake acknowledgment message sent by client to... |
| 0x0004 | error_response | Error response message sent when request processin... |
| 0x0005 | ping | Ping message sent by client to check connection li... |
| 0x0006 | pong | Pong message sent by server in response to ping.  ... |
| 0x0010 | subscribe_request | Request to subscribe to entity change notification... |
| 0x0011 | subscribe_response | Response confirming subscription request. |
| 0x0012 | unsubscribe_request | Request to unsubscribe from entity change notifica... |
| 0x0013 | unsubscribe_response | Response confirming unsubscription request. |
| 0x0014 | notification |  |

** handshake_request (0x0001)

Handshake request message sent by client to initiate connection.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| client_version_major | ~std::uint16_t~ |  |
| client_version_minor | ~std::uint16_t~ |  |
| client_identifier | ~std::string~ |  |

** handshake_response (0x0002)

Handshake response message sent by server to client.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| server_version_major | ~std::uint16_t~ |  |
| server_version_minor | ~std::uint16_t~ |  |
| version_compatible | ~bool~ |  |
| server_identifier | ~std::string~ |  |
| status | ~error_code~ |  |

** handshake_ack (0x0003)

Handshake acknowledgment message sent by client to complete handshake.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| status | ~error_code~ |  |

** error_response (0x0004)

Error response message sent when request processing fails.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| code | ~error_code~ |  |
| message | ~std::string~ |  |

** ping (0x0005)

Ping message sent by client to check connection liveness.  Lightweight keepalive message with no payload.

** pong (0x0006)

Pong message sent by server in response to ping.  Lightweight response message confirming connection is alive.

** subscribe_request (0x0010)

Request to subscribe to entity change notifications.  The client sends this to register interest in receiving notifications when a particular entity type changes.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| event_type | ~std::string~ |  |

*** Wire Format

- 2 bytes: event_type length
- N bytes: event_type (UTF-8)

** subscribe_response (0x0011)

Response confirming subscription request.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| success | ~bool~ |  |
| message | ~std::string~ |  |

*** Wire Format

- 1 byte: success (0 or 1)
- 2 bytes: message length
- N bytes: message (UTF-8)

** unsubscribe_request (0x0012)

Request to unsubscribe from entity change notifications.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| event_type | ~std::string~ |  |

*** Wire Format

- 2 bytes: event_type length
- N bytes: event_type (UTF-8)

** unsubscribe_response (0x0013)

Response confirming unsubscription request.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| success | ~bool~ |  |
| message | ~std::string~ |  |

*** Wire Format

- 1 byte: success (0 or 1)
- 2 bytes: message length
- N bytes: message (UTF-8)

** notification (0x0014)

(No struct definition found)

* Risk Subsystem (0x1000-0x1FFF)

** Messages Overview

| ID | Name | Description |
|----+------+-------------|
| 0x1001 | get_currencies_request | Request to retrieve currencies with pagination sup... |
| 0x1002 | get_currencies_response | Response containing currencies with pagination met... |
| 0x1003 | save_currency_request | Request to save a currency (create or update).  Du... |
| 0x1004 | save_currency_response | Response confirming currency save operation. |
| 0x1005 | delete_currency_request | Request to delete one or more currencies.  Support... |
| 0x1006 | delete_currency_response | Response confirming currency deletion(s).  Contain... |
| 0x1007 | get_currency_history_request | Request to retrieve version history for a currency... |
| 0x1008 | get_currency_history_response | Response containing currency version history. |

** get_currencies_request (0x1001)

Request to retrieve currencies with pagination support.  Supports pagination through offset and limit parameters.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| offset | ~std::uint32_t~ | Number of records to skip (0-based) |
| limit | ~std::uint32_t~ | Maximum number of records to return |

*** Wire Format

- 4 bytes: offset (uint32_t)
- 4 bytes: limit (uint32_t)

** get_currencies_response (0x1002)

Response containing currencies with pagination metadata.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| currencies | ~std::vector<domain::currency>~ |  |
| total_available_count | ~std::uint32_t~ | Total number of currencies available (not just in this page) |

*** Wire Format

- 4 bytes: total_available_count (uint32_t)
- 4 bytes: count (number of currencies in this response)
- For each currency:
- 2 bytes: iso_code length
- N bytes: iso_code (UTF-8)
- 2 bytes: name length
- N bytes: name (UTF-8)
- 2 bytes: numeric_code length
- N bytes: numeric_code (UTF-8)
- 2 bytes: symbol length
- N bytes: symbol (UTF-8)
- 2 bytes: fraction_symbol length
- N bytes: fraction_symbol (UTF-8)
- 4 bytes: fractions_per_unit (int)
- 2 bytes: rounding_type length
- N bytes: rounding_type (UTF-8)
- 4 bytes: rounding_precision (int)
- 2 bytes: format length
- N bytes: format (UTF-8)
- 2 bytes: currency_type length
- N bytes: currency_type (UTF-8)
- 2 bytes: modified_by length
- N bytes: modified_by (UTF-8)
- 2 bytes: valid_from length
- N bytes: valid_from (UTF-8)
- 2 bytes: valid_to length
- N bytes: valid_to (UTF-8)

** save_currency_request (0x1003)

Request to save a currency (create or update).  Due to bitemporal storage, both create and update operations result in writing a new record. Database triggers handle temporal versioning automatically.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| currency | ~domain::currency~ |  |

** save_currency_response (0x1004)

Response confirming currency save operation.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| success | ~bool~ |  |
| message | ~std::string~ |  |

** delete_currency_request (0x1005)

Request to delete one or more currencies.  Supports batch deletion by accepting a vector of ISO codes. Each currency is processed independently - partial success is possible.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| iso_codes | ~std::vector<std::string>~ |  |

*** Wire Format

- 4 bytes: count (number of ISO codes)
- For each ISO code:
- 2 bytes: length
- N bytes: iso_code (UTF-8)

** delete_currency_response (0x1006)

Response confirming currency deletion(s).  Contains one result per requested currency, indicating individual success or failure. Supports partial success in batch operations.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| results | ~std::vector<delete_currency_result>~ |  |

*** Wire Format

- 4 bytes: count (number of results)
- For each result:
- 2 bytes: iso_code length
- N bytes: iso_code (UTF-8)
- 1 byte: success (0 or 1)
- 2 bytes: message length
- N bytes: message (UTF-8)

** get_currency_history_request (0x1007)

Request to retrieve version history for a currency.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| iso_code | ~std::string~ |  |

** get_currency_history_response (0x1008)

Response containing currency version history.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| success | ~bool~ |  |
| message | ~std::string~ |  |
| history | ~domain::currency_version_history~ |  |

* Accounts Subsystem (0x2000-0x2FFF)

** Messages Overview

| ID | Name | Description |
|----+------+-------------|
| 0x2001 | create_account_request | Request to create a new account. |
| 0x2002 | create_account_response | Response containing the created account ID. |
| 0x2003 | list_accounts_request | Request to retrieve accounts with pagination suppo... |
| 0x2004 | list_accounts_response | Response containing accounts with pagination metad... |
| 0x2005 | login_request | Request to authenticate a user. |
| 0x2006 | login_response | Response containing authentication result and acco... |
| 0x2007 | unlock_account_request | Request to unlock a locked account.  Requires admi... |
| 0x2008 | unlock_account_response | Response indicating whether unlock operation succe... |
| 0x2009 | delete_account_request | Request to delete an account. |
| 0x200A | delete_account_response | Response confirming account deletion. |
| 0x200B | list_login_info_request | Request to retrieve all login info records. |
| 0x200C | list_login_info_response | Response containing all login info records. |
| 0x200D | logout_request | Request to logout the current user.  The server wi... |
| 0x200E | logout_response | Response indicating logout result. |
| 0x200F | create_initial_admin_request | Request to create the initial administrator accoun... |
| 0x2010 | create_initial_admin_response | Response from creating the initial administrator a... |
| 0x2011 | bootstrap_status_request | Request to check the bootstrap mode status.  This ... |
| 0x2012 | bootstrap_status_response | Response containing the bootstrap mode status. |
| 0x2013 | lock_account_request | Request to lock an account.  Requires admin privil... |
| 0x2014 | lock_account_response | Response indicating whether lock operation succeed... |

** create_account_request (0x2001)

Request to create a new account.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| username | ~std::string~ |  |
| password | ~std::string~ |  |
| totp_secret | ~std::string~ |  |
| email | ~std::string~ |  |
| modified_by | ~std::string~ |  |
| is_admin | ~bool~ |  |

*** Wire Format

- 2 bytes: username length
- N bytes: username (UTF-8)
- 2 bytes: password length
- N bytes: password (UTF-8)
- 2 bytes: totp_secret length
- N bytes: totp_secret (UTF-8)
- 2 bytes: email length
- N bytes: email (UTF-8)
- 2 bytes: modified_by length
- N bytes: modified_by (UTF-8)
- 1 byte: is_admin (boolean)

** create_account_response (0x2002)

Response containing the created account ID.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| account_id | ~boost::uuids::uuid~ |  |

*** Wire Format

- 16 bytes: account_id (UUID)

** list_accounts_request (0x2003)

Request to retrieve accounts with pagination support.  Supports pagination through offset and limit parameters.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| offset | ~std::uint32_t~ | Number of records to skip (0-based) |
| limit | ~std::uint32_t~ | Maximum number of records to return |

*** Wire Format

- 4 bytes: offset (uint32_t)
- 4 bytes: limit (uint32_t)

** list_accounts_response (0x2004)

Response containing accounts with pagination metadata.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| accounts | ~std::vector<domain::account>~ |  |
| total_available_count | ~std::uint32_t~ | Total number of accounts available (not just in this page) |

*** Wire Format

- 4 bytes: total_available_count (uint32_t)
- 4 bytes: count (number of accounts in this response)
- For each account:
- 4 bytes: version
- 2 bytes: modified_by length
- N bytes: modified_by (UTF-8)
- 16 bytes: id (UUID)
- 2 bytes: username length
- N bytes: username (UTF-8)
- 2 bytes: password_hash length
- N bytes: password_hash (UTF-8)
- 2 bytes: password_salt length
- N bytes: password_salt (UTF-8)
- 2 bytes: totp_secret length
- N bytes: totp_secret (UTF-8)
- 2 bytes: email length
- N bytes: email (UTF-8)
- 1 byte: is_admin (boolean)

** login_request (0x2005)

Request to authenticate a user.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| username | ~std::string~ |  |
| password | ~std::string~ |  |

*** Wire Format

- 2 bytes: username length
- N bytes: username (UTF-8)
- 2 bytes: password length
- N bytes: password (UTF-8)

** login_response (0x2006)

Response containing authentication result and account information.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| success | ~bool~ |  |
| error_message | ~std::string~ |  |
| account_id | ~boost::uuids::uuid~ |  |
| username | ~std::string~ |  |
| is_admin | ~bool~ |  |

*** Wire Format

- 1 byte: success (boolean)
- 2 bytes: error_message length
- N bytes: error_message (UTF-8)
- 16 bytes: account_id (UUID)
- 2 bytes: username length
- N bytes: username (UTF-8)
- 1 byte: is_admin (boolean)

** unlock_account_request (0x2007)

Request to unlock a locked account.  Requires admin privileges - the server verifies the requester's identity from the session context.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| account_id | ~boost::uuids::uuid~ |  |

*** Wire Format

- 16 bytes: account_id (UUID)

** unlock_account_response (0x2008)

Response indicating whether unlock operation succeeded.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| success | ~bool~ |  |
| error_message | ~std::string~ |  |

*** Wire Format

- 1 byte: success (boolean)
- 2 bytes: error_message length
- N bytes: error_message (UTF-8)

** delete_account_request (0x2009)

Request to delete an account.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| account_id | ~boost::uuids::uuid~ |  |

*** Wire Format

- 16 bytes: account_id (UUID)

** delete_account_response (0x200A)

Response confirming account deletion.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| success | ~bool~ |  |
| message | ~std::string~ |  |

*** Wire Format

- 1 byte: success (boolean)
- 2 bytes: message length
- N bytes: message (UTF-8)

** list_login_info_request (0x200B)

Request to retrieve all login info records.

** list_login_info_response (0x200C)

Response containing all login info records.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| login_infos | ~std::vector<domain::login_info>~ |  |

** logout_request (0x200D)

Request to logout the current user.  The server will set login_info.online to false for the specified account and close the connection after sending the response.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| account_id | ~boost::uuids::uuid~ |  |

*** Wire Format

- 16 bytes: account_id (UUID)

** logout_response (0x200E)

Response indicating logout result.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| success | ~bool~ |  |
| message | ~std::string~ |  |

*** Wire Format

- 1 byte: success (boolean)
- 2 bytes: message length
- N bytes: message (UTF-8)

** create_initial_admin_request (0x200F)

Request to create the initial administrator account.  This endpoint is only available during bootstrap mode (when no admin accounts exist). It must be called from localhost only.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| username | ~std::string~ |  |
| password | ~std::string~ |  |
| email | ~std::string~ |  |

*** Wire Format

- 2 bytes: username length
- N bytes: username (UTF-8)
- 2 bytes: password length
- N bytes: password (UTF-8)
- 2 bytes: email length
- N bytes: email (UTF-8)

** create_initial_admin_response (0x2010)

Response from creating the initial administrator account.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| success | ~bool~ |  |
| error_message | ~std::string~ |  |
| account_id | ~boost::uuids::uuid~ |  |

*** Wire Format

- 1 byte: success (boolean)
- 2 bytes: error_message length
- N bytes: error_message (UTF-8)
- 16 bytes: account_id (UUID)

** bootstrap_status_request (0x2011)

Request to check the bootstrap mode status.  This endpoint is always available and returns whether the system is in bootstrap mode (waiting for initial admin) or secure mode (admin exists).

** bootstrap_status_response (0x2012)

Response containing the bootstrap mode status.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| is_in_bootstrap_mode | ~bool~ |  |
| message | ~std::string~ |  |

*** Wire Format

- 1 byte: is_in_bootstrap_mode (boolean)
- 2 bytes: message length
- N bytes: message (UTF-8)

** lock_account_request (0x2013)

Request to lock an account.  Requires admin privileges - the server verifies the requester's identity from the session context.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| account_id | ~boost::uuids::uuid~ |  |

*** Wire Format

- 16 bytes: account_id (UUID)

** lock_account_response (0x2014)

Response indicating whether lock operation succeeded.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| success | ~bool~ |  |
| error_message | ~std::string~ |  |

*** Wire Format

- 1 byte: success (boolean)
- 2 bytes: error_message length
- N bytes: error_message (UTF-8)

* Variability Subsystem (0x3000-0x3FFF)

** Messages Overview

| ID | Name | Description |
|----+------+-------------|
| 0x3000 | list_feature_flags_request | Request to retrieve all feature flags. |
| 0x3001 | list_feature_flags_response | Response containing all feature flags. |

** list_feature_flags_request (0x3000)

Request to retrieve all feature flags.

** list_feature_flags_response (0x3001)

Response containing all feature flags.

*** Fields

| Field | Type | Description |
|-------+------+-------------|
| feature_flags | ~std::vector<domain::feature_flags>~ |  |

* Error Codes

| Code | Name |
|------+------|
| 0x0000 | none |
| 0x0001 | version_mismatch |
| 0x0002 | crc_validation_failed |
| 0x0003 | invalid_message_type |
| 0x0004 | handshake_timeout |
| 0x0005 | handshake_failed |
| 0x0006 | payload_too_large |
| 0x0007 | network_error |
| 0x0008 | handler_error |
| 0x0009 | database_error |
| 0x000A | authentication_failed |
| 0x000B | authorization_failed |
| 0x000C | invalid_request |
| 0x000D | bootstrap_mode_only |
| 0x000E | bootstrap_mode_forbidden |
| 0x000F | weak_password |
| 0x0010 | not_localhost |
