:PROPERTIES:
:ID: 8A1C5E2D-9B4F-4E8A-A7C3-6F2D1E0B9A5C
:END:
#+title: ORE Studio Geo Component
#+author: Marco Craveiro
#+options: <:nil c:nil todo:nil ^:nil d:nil date:nil author:nil toc:nil html-postamble:nil
#+startup: inlineimages

Geolocation services for IP-to-location lookups in [[id:D04D3476-D7C5-3954-A33B-C641EBCB43F6][ORE Studio]].

* Component Architecture

Diagram:

#+attr_html: :width 100% :alt Description
#+caption: ORE Studio Geo Component Diagram
[[file:ores.geo.png][file:ores.geo.png]]

Provides geolocation capabilities for mapping IP addresses to geographic
locations. Used primarily for session tracking to record where logins
originate from. Key features:

- PostgreSQL Storage: Stores MaxMind GeoLite2-City data in PostgreSQL
- IP to Location: Maps IP addresses to country, city, and coordinates
- Thread Safe: All lookup operations are thread-safe for concurrent access
- GiST Indexes: Uses PostgreSQL native inet type with GiST indexes for efficient lookups

The service namespace provides the geolocation_service implementation that
queries PostgreSQL geoip tables.

* Data Source

** MaxMind GeoLite2-City CSV

The data source is the MaxMind GeoLite2-City database in CSV format:

- Download: https://dev.maxmind.com/geoip/geolite2-free-geolocation-data
- Format: CSV files for import into PostgreSQL
- Updates: Monthly updates available from MaxMind
- License: CC BY-SA 4.0 (requires attribution)

** PostgreSQL Schema

Geolocation data is stored in PostgreSQL with the following tables:

- =geoip_locations=: Country, city, and timezone data
- =geoip_blocks_ipv4=: IPv4 CIDR blocks mapped to locations
- =geoip_blocks_ipv6=: IPv6 CIDR blocks mapped to locations
- =geoip_lookup()=: Function to lookup IP address and return location data

** Setup Instructions

1. Create the schema:
   #+begin_src sql
   psql -d ores -f projects/sql/schema/geolocation_create.sql
   #+end_src

2. Download and extract GeoLite2-City-CSV.zip from MaxMind

3. Import the data:
   #+begin_src sql
   psql -d ores -v data_dir='/path/to/GeoLite2-City-CSV' \
        -f projects/sql/data/geolocation_import.sql
   #+end_src

| Top: [[id:C0CF98E8-082F-2F04-2533-94B2DA9BE3D2][Documentation]] | Previous: [[id:D773166D-0C91-8CB4-3323-42166BC07687][System Model]] |
