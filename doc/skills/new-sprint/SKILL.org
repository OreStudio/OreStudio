:PROPERTIES:
:ID: C5EEF144-BB9D-2F44-453B-4B7338D8A457
:END:
#+title: New Sprint Skill
#+author: Marco Craveiro
#+options: <:nil c:nil todo:nil ^:nil d:nil date:nil author:nil toc:nil
#+startup: inlineimages
#+export_exclude_tags: noexport

#+begin_export markdown
---
name: new-sprint-skill
description: Open a new ORE Studio sprint by updating all required files.
license: Complete terms in LICENSE.txt
---
#+end_export

This skill updates all files related to version and task management for a new
Agile sprint in the ORE Studio project.

* When to use this skill

When the user requests to open a new sprint for the ORE Studio project. This
involves updating version numbers across multiple files and creating a new
sprint backlog document.

* How to use this skill

** Workflow summary

1. Ask the user if a new branch is required.
2. Determine the current and new sprint numbers.
3. Confirm the new sprint number with the user.
4. Follow the detailed instructions to update all required files.
5. Commit and raise a PR.

** Files to update

| File                                    | Change                                  |
|-----------------------------------------+-----------------------------------------|
| =readme.org=                            | Sprint badge, commits-since, version    |
| =CMakeLists.txt=                        | Project VERSION                         |
| =vcpkg.json=                            | version-string                          |
| =.github/workflows/continuous-linux.yml=  | Package filename version                |
| =.github/workflows/continuous-macos.yml=  | Package filename version                |
| =.github/workflows/continuous-windows.yml= | Package filename version               |
| =doc/agile/v0/version_zero.org=         | Add sprint backlog link                 |
| =doc/agile/v0/sprint_backlog_NN.org=    | *New file* - sprint backlog document    |

* Detailed instructions

** Step 1: Determine branch strategy

Ask the user if a new branch is required:

- If yes: create =feature/new_sprint= branched off =main=
- If no: use the current branch

#+begin_src sh
git fetch origin main && git checkout -b feature/new_sprint origin/main
#+end_src

** Step 2: Determine sprint numbers

Look at files in =doc/agile/v0= with names matching =sprint_backlog_NN.org=.

- The file with the highest =NN= is the *current sprint*
- The *new sprint* is current + 1

Example: If =sprint_backlog_10.org= exists and is the highest, current sprint is
10 and new sprint is 11.

** Step 3: Confirm with user

Confirm the new sprint number with the user before proceeding.

** Step 4: Update readme.org

Make three changes to =readme.org=:

*** 4.1: Update sprint badge

Change the sprint number in the badge URL and text:

#+begin_src diff
-#+html: <a href="https://orestudio.github.io/OreStudio/doc/agile/v0/sprint_backlog_10.html"><img alt="Agile Sprint" src="https://img.shields.io/badge/Sprint-10-blue.svg"/></a>
+#+html: <a href="https://orestudio.github.io/OreStudio/doc/agile/v0/sprint_backlog_11.html"><img alt="Agile Sprint" src="https://img.shields.io/badge/Sprint-11-blue.svg"/></a>
#+end_src

*** 4.2: Update commits-since badge

Update to the *previous* sprint version (current sprint, not new sprint):

#+begin_src diff
-#+html: <a href="https://github.com/OreStudio/OreStudio/commits/main"><img alt="Commits" src= "https://img.shields.io/github/commits-since/OreStudio/OreStudio/v0.0.9.svg"/></a>
+#+html: <a href="https://github.com/OreStudio/OreStudio/commits/main"><img alt="Commits" src= "https://img.shields.io/github/commits-since/OreStudio/OreStudio/v0.0.10.svg"/></a>
#+end_src

*** 4.3: Update version text

Update the example version in the documentation:

#+begin_src diff
-Where =${VERSION}= is your ORE Studio version, such as =0.0.10=.
+Where =${VERSION}= is your ORE Studio version, such as =0.0.11=.
#+end_src

** Step 5: Update CMakeLists.txt

Update the project VERSION in the top-level =CMakeLists.txt=:

#+begin_src diff
-project(OreStudio VERSION 0.0.10 LANGUAGES CXX
+project(OreStudio VERSION 0.0.11 LANGUAGES CXX
#+end_src

** Step 6: Update vcpkg.json

Update the version-string in =vcpkg.json=:

#+begin_src diff
-    "version-string": "0.0.10",
+    "version-string": "0.0.11",
#+end_src

** Step 7: Update GitHub workflow files

Update the package version in all three workflow files under =.github/workflows/=:

*** 7.1: continuous-linux.yml

#+begin_src diff
-          path: ./build/output/${{matrix.family}}-${{matrix.compiler}}-${{matrix.buildtype}}/packages/orestudio_0.0.10_amd64.deb
+          path: ./build/output/${{matrix.family}}-${{matrix.compiler}}-${{matrix.buildtype}}/packages/orestudio_0.0.11_amd64.deb
#+end_src

*** 7.2: continuous-macos.yml

#+begin_src diff
-          path: ./build/output/${{matrix.family}}-${{matrix.compiler}}-${{matrix.buildtype}}/packages/OreStudio-0.0.10-Darwin.dmg
+          path: ./build/output/${{matrix.family}}-${{matrix.compiler}}-${{matrix.buildtype}}/packages/OreStudio-0.0.11-Darwin.dmg
#+end_src

*** 7.3: continuous-windows.yml

#+begin_src diff
-          path: ./build/output/${{matrix.family}}-${{matrix.compiler}}-${{matrix.buildtype}}/packages/OreStudio-0.0.10-win64.*
+          path: ./build/output/${{matrix.family}}-${{matrix.compiler}}-${{matrix.buildtype}}/packages/OreStudio-0.0.11-win64.*
#+end_src

** Step 8: Generate UUID for new sprint backlog

Generate a new UUID using the =uuid= command:

#+begin_src sh
uuid
#+end_src

Save this UUID for use in steps 9 and 10.

** Step 9: Update version_zero.org

Add the sprint backlog link to the appropriate sprint section in
=doc/agile/v0/version_zero.org=:

#+begin_src diff
 ** Sprint 10
    :PROPERTIES:
    :resource_id: s10
    :END:

+- [[id:A734018F-A4A7-F8A4-8F5B-DE0C74344940][Sprint Backlog 10]] | Data quality and code generation work.
+
 ** Sprint 11
    :PROPERTIES:
    :resource_id: s11
    :END:

+- [[id:NEW-UUID-HERE][Sprint Backlog 11]] | TBD.
+
 ** Sprint 12
#+end_src

Use the UUID generated in Step 8 for the new sprint backlog link.

** Step 10: Create sprint backlog file

Create a new file =doc/agile/v0/sprint_backlog_NN.org= using the template below.

*** 10.1: Create template and stage

First create the file with the template content and git stage it:

#+begin_src sh
git add doc/agile/v0/sprint_backlog_NN.org
#+end_src

*** 10.2: Update template values

Then update the following in the file:

- Replace =GUID= with the UUID from Step 8 (uppercase)
- Replace all =05= references with the new sprint number (=NN=)
- Update the =#+title:= to =Sprint Backlog NN=
- Update all filename references (=sprint_backlog_05_*= to =sprint_backlog_NN_*=)
- Update all ggtitle references (="Sprint 5:"= to ="Sprint NN:"=)
- Update the clock table dates to today's date
- Set the sprint mission to =TBD.=

** Step 11: Verify changes

Review all changes with:

#+begin_src sh
git status
git diff --stat HEAD
#+end_src

** Step 12: Commit and raise PR

Stage all changes, commit, and raise a PR:

#+begin_src sh
git add -A
git commit -m "[agile] Open Sprint NN"
git push -u origin feature/new_sprint
gh pr create --title "[agile] Open Sprint NN" --body "Opens Sprint NN for development."
#+end_src

* Sprint backlog template                                          :noexport:

#+begin_src fundamental
:PROPERTIES:
:ID: GUID
:END:
#+title: Sprint Backlog 05
#+options: <:nil c:nil ^:nil d:nil date:nil author:nil toc:nil html-postamble:nil
#+todo: STARTED | COMPLETED CANCELLED POSTPONED BLOCKED
#+tags: { code(c) infra(i) analysis(n) agile(a) }
#+startup: inlineimages

,* Sprint Mission

- TBD.

,* Stories

,** Active

#+begin: clocktable :maxlevel 3 :scope subtree :tags t :indent nil :emphasize nil :scope file :narrow 75 :formula % :block today
#+TBLNAME: today_summary
#+CAPTION: Clock summary at [2026-01-28 Tue 00:00], for Tuesday, January 28, 2026.
|      | <75>         |        |     |
| Tags | Headline     | Time   |   % |
|------+--------------+--------+-----|
|      | *Total time* | *0:00* | 0.0 |
#+end:

#+begin: clocktable :maxlevel 3 :scope subtree :tags t :indent nil :emphasize nil :scope file :narrow 75 :formula %
#+TBLNAME: sprint_summary
#+CAPTION: Clock summary at [2026-01-28 Tue 00:00]
|      | <75>         |        |     |
| Tags | Headline     | Time   |   % |
|------+--------------+--------+-----|
|      | *Total time* | *0:00* | 0.0 |
#+end:

,*** Sprint and product backlog refinement                             :agile:

Updates to sprint and product backlog.

,#+begin_src emacs-lisp :exports none
;; agenda
(org-agenda-file-to-front)
,#+end_src

,#+name: pie-stories-chart
,#+begin_src R :var sprint_summary=sprint_summary :colnames yes :results file graphics :exports results :file sprint_backlog_05_stories_pie_sorted.png :width 1920 :height 1080
library(conflicted)
library(ggplot2)
library(tidyverse)
library(tibble)

# Filter to only rows with actual story data (non-empty Tags column)
clean_sprint_summary <- sprint_summary %>% dplyr::filter(!is.na(Tags) & nzchar(Tags))
stories <- unlist(clean_sprint_summary[2])
percent_values <- as.numeric(unlist(clean_sprint_summary[6]))

# Create a data frame and explicitly sort the stories by defining factor levels
df <- data.frame(
  stories = stories,
  percent = percent_values
) %>%
  # 1. Sort the data frame by percentage in descending order
  arrange(desc(percent)) %>%
  # 2. Convert 'stories' to a factor, setting the levels based on the sorted order.
  # This makes the order of the slices explicit for ggplot.
  mutate(
    stories = factor(stories, levels = stories),
    lab.pos = cumsum(percent) - 0.5 * percent
  )

# Manually selected colors to resemble the screenshot
custom_palette <- c(
  "#21518f", "#f37735", "#ffc425", "#81b214", "#d7385e",
  "#662e91", "#00a9ae", "#5c5c5c", "#a0c6e0", "#f8b195",
  "#ffe385", "#bde0fe", "#c5e0d4", "#e0b8a0", "#a56f8f",
  "#7a448a", "#4a9a9b", "#9b9b9b", "#6fa8dc", "#f7a072",
  "#ffd166", "#99d98c", "#ef5d60", "#9d529f", "#3a86ff",
  "#c1d6e1", "#f9e0ac", "#c2d6a4", "#e69a8d", "#a07d9f"
)

# Ensure the palette has enough colors for all stories.
if (length(custom_palette) < length(df$stories)) {
  warning("Not enough custom colors for all stories. Colors will repeat.")
  custom_palette <- rep(custom_palette, length.out = length(df$stories))
}


p <- ggplot(df, aes(x = "", y = percent, fill = stories)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values = custom_palette) +
  ggtitle("Sprint 5: Resourcing per Story")  +
  labs(x = NULL, y = NULL, fill = "Stories") +
  theme_minimal() +
  theme(
    axis.text.x = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(hjust = 0.5, size = 18),
    legend.position = "right",
    legend.title = element_text(size = 14),
    legend.text = element_text(size = 12)
  )

print(p)
,#+end_src

,#+RESULTS: pie-stories-chart
[[file:sprint_backlog_05_stories_pie_sorted.png]]

,#+name: stories-chart
,#+begin_src R :var sprint_summary=sprint_summary :colnames yes :results file graphics :exports results :file sprint_backlog_05_stories.png :width 1200 :height 650
library(conflicted)
library(grid)
library(tidyverse)
library(tibble)

# Filter to only rows with actual story data (non-empty Tags column)
clean_sprint_summary <- sprint_summary %>% dplyr::filter(Tags != "")
names <- unlist(clean_sprint_summary[2])
values <- as.numeric(unlist(clean_sprint_summary[6]))

# Create a data frame.
df <- data.frame(
  cost = values,
  stories = factor(names, levels = names[order(values, decreasing = FALSE)]),
  y = seq(length(names)) * 0.9
)

# Setup the colors
blue <- "#076fa2"

p <- ggplot(df) +
  aes(x = cost, y = stories) +
  geom_col(fill = blue, width = 0.6) +
  ggtitle("Sprint 5: Resourcing per Story") +
  xlab("Resourcing (%)") + ylab("Stories") +
  theme(text = element_text(size = 15))

print(p)
,#+end_src

,#+RESULTS: stories-chart
[[file:sprint_backlog_05_stories.png]]

,#+name: tags-chart
,#+begin_src R :var sprint_summary=sprint_summary :colnames yes :results file graphics :exports results :file sprint_backlog_05_tags.png :width 600 :height 400
library(conflicted)
library(grid)
library(tidyverse)
library(tibble)

# Filter to only rows with actual story data (non-empty Tags column)
clean_sprint_summary <- sprint_summary %>% dplyr::filter(Tags != "")
names <- unlist(clean_sprint_summary[1])
values <- as.numeric(unlist(clean_sprint_summary[6]))

# Create a data frame.
df <- data.frame(
  cost = values,
  tags = names,
  y = seq(length(names)) * 0.9
)
# factor(names, levels = names[order(values, decreasing = FALSE)])

df2 <- setNames(aggregate(df$cost, by = list(df$tags), FUN = sum),  c("cost", "tags"))
# Setup the colors
blue <- "#076fa2"

p <- ggplot(df2) +
  aes(x = cost, y = tags) +
  geom_col(fill = blue, width = 0.6) +
  ggtitle("Sprint 5: Resourcing per Tag") +
  xlab("Resourcing (%)") + ylab("Story types") +
  theme(text = element_text(size = 15))

print(p)
,#+end_src

,#+RESULTS: tags-chart
[[file:sprint_backlog_05_tags.png]]


,*** Footer

| Previous: [[id:154212FF-BB02-8D84-1E33-9338B458380A][Version Zero]] |
#+end_src
