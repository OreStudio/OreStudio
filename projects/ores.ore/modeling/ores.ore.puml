' -*- mode: plantuml; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-
'
' Copyright (C) 2025 Marco Craveiro <marco.craveiro@gmail.com>
'
' This program is free software; you can redistribute it and/or modify it under
' the terms of the GNU General Public License as published by the Free Software
' Foundation; either version 3 of the License, or (at your option) any later
' version.
'
' This program is distributed in the hope that it will be useful, but WITHOUT
'  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
' FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
'
' You should have received a copy of the GNU General Public License along with
' GNU Emacs; see the file COPYING. If not, write to the Free Software
' Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
@startuml
!pragma layout smetana

title ores.ore - ORE Component

set namespaceSeparator ::

namespace ores #F2F2F2 {
    namespace ore #F2F2F2 {

        note "Provides ORE (Open Source Risk Engine) specific\nfunctionality for XML import/export" as ore_note

        namespace domain #E8E8E8 {

            struct CurrencyConfig <<D,#FFFFCC>> {
                +Currency : vector<CurrencyElement>
                --
                +{static} to_xml(v : CurrencyConfig) : string
                +{static} from_xml(xml : string) : CurrencyConfig
            }

            struct CurrencyElement <<D,#FFFFCC>> {
                +Name : string
                +ISOCode : string
                +NumericCode : string
                +Symbol : string
                +FractionSymbol : string
                +FractionsPerUnit : int
                +RoundingType : string
                +RoundingPrecision : int
                +Format : optional<string>
                +CurrencyType : optional<string>
            }

            class currency_mapper <<U,#CCFFCC>> {
                +{static} map(v : CurrencyElement) : currency
                +{static} map(v : currency) : CurrencyElement
                +{static} map(v : CurrencyConfig) : vector<currency>
                +{static} map(v : vector<currency>) : CurrencyConfig
            }

            class parsing_error <<X,#FF5555>> {
                -message_ : string
                --
                +parsing_error(message : string_view)
                +what() : const char*
            }

            CurrencyConfig *-- "0..*" CurrencyElement : contains

            note "Maps refdata::domain::currency\nto/from ORE XML types" as mapper_note
            currency_mapper .. mapper_note
        }

        namespace xml #E8E8E8 {

            class importer <<U,#CCFFCC>> {
                +{static} validate_currency(currency : currency) : string
                +{static} import_currency_config(path : path) : vector<currency>
            }

            class exporter <<U,#CCFFCC>> {
                +{static} export_currency_config(v : vector<currency>) : string
            }

            note "Uses rfl (reflect-cpp) for\nXML serialization" as xml_note
            importer .. xml_note
        }

        ' Cross-namespace relationships
        domain::currency_mapper ..> xml::importer : used by
        domain::currency_mapper ..> xml::exporter : used by
        domain::parsing_error <.. xml::importer : throws
    }
}

' Local Variables:
' compile-command: "java -Djava.awt.headless=true -DPLANTUML_SECURITY_PROFILE=UNSECURE -DPLANTUML_LIMIT_SIZE=65535 -jar /usr/share/plantuml/plantuml.jar ores.ore.puml"
' End:
@enduml
