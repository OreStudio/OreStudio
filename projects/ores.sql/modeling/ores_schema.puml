' -*- mode: plantuml; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-
'
' Copyright (C) 2025 Marco Craveiro <marco.craveiro@gmail.com>
'
' This program is free software; you can redistribute it and/or modify it under
' the terms of the GNU General Public License as published by the Free Software
' Foundation; either version 3 of the License, or (at your option) any later
' version.
'
' This program is distributed in the hope that it will be useful, but WITHOUT
'  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
' FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
'
' You should have received a copy of the GNU General Public License along with
' GNU Emacs; see the file COPYING. If not, write to the Free Software
' Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
'
' GENERATED FILE - DO NOT EDIT
' Generated: 2026-02-02T09:16:51.838896Z
' Regenerate with: ./projects/ores.codegen/plantuml_er_generate.sh
'
@startuml

title ORES Database Schema
hide circle
skinparam linetype ortho

' Layout settings for a more compact diagram
' left to right direction stacks packages vertically
left to right direction
skinparam packageStyle rectangle
skinparam nodesep 10
skinparam ranksep 30

note as SchemaNote
ORES Database Schema

Schemas:
- metadata: Data governance, classification, staging (dq_*)
- production: Operational data (refdata_*, iam_*, assets_*, etc.)

All temporal tables use valid_from/valid_to
for bitemporal data management. Junction tables enable
soft deletes via validity period closure.

Change tracking: Most entities include change_reason_code
and change_commentary for audit trail support.

Table naming: <component>_<entity>_tbl
end note

'
' ==================== iam (Identity & Access Management) ====================
'
package "iam" #E8F4FD {
    entity ores_iam_account_roles_tbl <<junction>> #ECECEC {
        * account_id : uuid <<PK, FK>>
        * role_id : uuid <<PK, FK>>
        * valid_from : timestamptz <<PK>>
        --
        * tenant_id : uuid <<FK>>
        * assigned_by : text
        * assigned_at : timestamptz
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_to : timestamptz
    }

    note right of ores_iam_account_roles_tbl
    Many-to-many: accounts to roles.
    Tracks who assigned the role.
    end note

    entity ores_iam_accounts_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * id : uuid <<PK>>
        --
        * version : integer
        * username : text
        * password_hash : text
        * password_salt : text
        * totp_secret : text
        * email : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_iam_accounts_tbl
    User accounts with authentication credentials.
    Supports optimistic locking via version field.
    Username and email unique for current records.
    end note

    entity ores_iam_login_info_tbl  #F7E5FF {
        * account_id : uuid <<PK, FK>>
        --
        * tenant_id : uuid <<FK>>
        * last_ip : inet
        * last_attempt_ip : inet
        * failed_logins : integer
        * locked : integer
        * last_login : timestamptz
        * online : integer
        * password_reset_required : integer
    }

    note right of ores_iam_login_info_tbl
    Security tracking for login attempts.
    Current-state table (no temporal versioning).
    Tracks failed attempts and lock status.
    end note

    entity ores_iam_permissions_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * id : uuid <<PK>>
        --
        * code : text
        * description : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_iam_permissions_tbl
    Fine-grained permission codes.
    System-defined constants from bootstrap data.
    No change tracking (not user-editable).
    end note

    entity ores_iam_role_permissions_tbl <<junction>> #ECECEC {
        * role_id : uuid <<PK, FK>>
        * permission_id : uuid <<PK, FK>>
        * valid_from : timestamptz <<PK>>
        --
        * tenant_id : uuid <<FK>>
        * valid_to : timestamptz
    }

    note right of ores_iam_role_permissions_tbl
    Many-to-many: roles to permissions.
    end note

    entity ores_iam_roles_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * id : uuid <<PK>>
        --
        * version : integer
        * name : text
        * description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_iam_roles_tbl
    Named roles for grouping permissions.
    Examples: admin, viewer, editor.
    end note

    entity ores_iam_sessions_tbl  #F7E5FF {
        * id : uuid <<PK>>
        * start_time : timestamptz <<PK>>
        --
        * tenant_id : uuid <<FK>>
        * account_id : uuid <<FK>>
        * end_time : text
        * client_ip : text
        * client_identifier : text
        * client_version_major : smallint
        * client_version_minor : smallint
        * bytes_sent : bigint
        * bytes_received : bigint
        * country_code : text
        * protocol : text
    }

    note right of ores_iam_sessions_tbl
    User session tracking with country-level geolocation.
    Designed for TimescaleDB hypertable.
    Partitioned by start_time.
    end note

    entity ores_iam_tenant_statuses_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * status : text <<PK>>
        --
        * version : integer <<unique>>
        * name : text
        * description : text
        * display_order : integer
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_iam_tenant_statuses_tbl
    Tenant Statuses - Valid tenant lifecycle statuses
    end note

    entity ores_iam_tenant_types_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * type : text <<PK>>
        --
        * version : integer <<unique>>
        * name : text
        * description : text
        * display_order : integer
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_iam_tenant_types_tbl
    Tenant Types - Valid tenant type classifications
    end note

    entity ores_iam_tenants_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK>>
        --
        * version : integer
        * type : text
        * code : text
        * name : text
          description : text
        * hostname : text
        * status : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_iam_tenants_tbl
    Tenants Table
    Core table for multi-tenancy support. Each tenant represents an isolated
    organisation or the system platform tenant.
    end note

}

'
' ==================== assets (Digital Assets) ====================
'
package "assets" #F3E5F5 {
    entity ores_assets_image_tags_tbl <<junction>> #ECECEC {
        * image_id : uuid <<PK, FK>>
        * tag_id : uuid <<PK, FK>>
        * valid_from : timestamptz <<PK>>
        --
        * tenant_id : uuid <<FK>>
        * assigned_by : text
        * assigned_at : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_assets_image_tags_tbl
    Many-to-many: images to tags.
    end note

    entity ores_assets_images_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * image_id : uuid <<PK>>
        --
        * version : integer
        * key : text
        * description : text
        * svg_data : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_assets_images_tbl
    SVG image storage.
    Key provides human-readable lookup.
    end note

    entity ores_assets_tags_tbl <<junction>> #ECECEC {
        * tag_id : uuid <<PK>>
        * valid_from : timestamptz <<PK>>
        --
        * tenant_id : uuid <<FK>>
        * version : integer
        * name : text
        * description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_to : timestamptz
    }

    note right of ores_assets_tags_tbl
    Categories for images.
    Examples: flag, currency, commodity.
    end note

}

'
' ==================== refdata (Reference Data) ====================
'
package "refdata" #FFF3E0 {
    entity ores_refdata_account_types_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        * coding_scheme_code : text <<PK, FK>>
        --
        * version : integer <<unique>>
          source : text
          description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_account_types_tbl
    Contains a code representing the type of an account, for example in a clearing or exchange model.
    end note

    entity ores_refdata_asset_classes_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        * coding_scheme_code : text <<PK, FK>>
        --
        * version : integer <<unique>>
          source : text
          description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_asset_classes_tbl
    Defines a simple asset class categorization. Used for classification of the risk class of the trade.
    end note

    entity ores_refdata_asset_measures_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        * coding_scheme_code : text <<PK, FK>>
        --
        * version : integer <<unique>>
          source : text
          description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_asset_measures_tbl
    The type of measure about an asset. Used for escribing valuation, sensitivity, and risk measures.
    end note

    entity ores_refdata_benchmark_rates_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        * coding_scheme_code : text <<PK, FK>>
        --
        * version : integer <<unique>>
          source : text
          description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_benchmark_rates_tbl
    FpML Benchmark rates
    end note

    entity ores_refdata_business_centres_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        * coding_scheme_code : text <<PK, FK>>
        --
        * version : integer <<unique>>
          source : text
          description : text
          image_id : uuid <<FK>>
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_business_centres_tbl
    The coding-scheme accepts a 4 character code of the real geographical business calendar location or FpML format of the rate publication calendar. While the 4 character codes of the business calendar location are implicitly locatable and used for identifying a bad business day for the purpose of payment and rate calculation day adjustments, the rate publication calendar codes are used in the context of the fixing day offsets.
    end note

    entity ores_refdata_business_processes_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        * coding_scheme_code : text <<PK, FK>>
        --
        * version : integer <<unique>>
          source : text
          description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_business_processes_tbl
    Contains a code representing the type of business process a message (e.g. a status request) applies to.
    end note

    entity ores_refdata_cashflow_types_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        * coding_scheme_code : text <<PK, FK>>
        --
        * version : integer <<unique>>
          source : text
          description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_cashflow_types_tbl
    The type of cash flows associated with OTC derivatives contracts and their lifecycle events.
    end note

    entity ores_refdata_countries_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * alpha2_code : text <<PK>>
        --
        * version : integer
        * alpha3_code : text
        * numeric_code : text
        * name : text
        * official_name : text
          coding_scheme_code : text <<FK>>
          image_id : uuid <<FK>>
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_countries_tbl
    ISO 3166-1 country definitions.
    Includes alpha-2, alpha-3, and numeric codes.
    Optional flag image reference.
    coding_scheme_code tracks data provenance.
    end note

    entity ores_refdata_currencies_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * iso_code : text <<PK>>
        --
        * version : integer <<unique>>
        * name : text
        * numeric_code : text
        * symbol : text
        * fraction_symbol : text
        * fractions_per_unit : integer
        * rounding_type : text
        * rounding_precision : integer
        * format : text
        * currency_type : text
          coding_scheme_code : text <<FK>>
          image_id : uuid <<FK>>
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_currencies_tbl
    ISO 4217 currency definitions
    end note

    entity ores_refdata_entity_classifications_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        * coding_scheme_code : text <<PK, FK>>
        --
        * version : integer <<unique>>
          source : text
          description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_entity_classifications_tbl
    Financial Entity Indicator as defined by the CFTC.
    end note

    entity ores_refdata_local_jurisdictions_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        * coding_scheme_code : text <<PK, FK>>
        --
        * version : integer <<unique>>
          source : text
          description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_local_jurisdictions_tbl
    This overrides the countryScheme. Specifies the Local Jurisdiction that applies to a Transaction, for example for the purposes of defining which Local Taxes will apply.
    end note

    entity ores_refdata_party_relationships_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        * coding_scheme_code : text <<PK, FK>>
        --
        * version : integer <<unique>>
          source : text
          description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_party_relationships_tbl
    Indicates the relationship between two parties as defined by Hong Kong Monetary Authority (HKMA) Rewrite field 189 - Intragroup.
    end note

    entity ores_refdata_party_roles_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        * coding_scheme_code : text <<PK, FK>>
        --
        * version : integer <<unique>>
          source : text
          description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_party_roles_tbl
    Contains a code representing a related party role. This can be extended to provide custom roles.
    end note

    entity ores_refdata_person_roles_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        * coding_scheme_code : text <<PK, FK>>
        --
        * version : integer <<unique>>
          source : text
          description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_person_roles_tbl
    Indicates the role of a person in a transaction.
    end note

    entity ores_refdata_regulatory_corporate_sectors_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        * coding_scheme_code : text <<PK, FK>>
        --
        * version : integer <<unique>>
          source : text
          description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_regulatory_corporate_sectors_tbl
    Defines the corporate sector under HKMA (Hong Kong Monetary Authority) Rewrite fields 190 - Nature of Counterparty 1 and 191 - Nature of Counterparty 2.
    end note

    entity ores_refdata_reporting_regimes_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        * coding_scheme_code : text <<PK, FK>>
        --
        * version : integer <<unique>>
          source : text
          description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_reporting_regimes_tbl
    Contains a code representing a reporting regime under which this transaction may be reported.
    end note

    entity ores_refdata_rounding_types_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        --
        * version : integer <<unique>>
        * name : text
        * description : text
        * display_order : integer
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_rounding_types_tbl
    Rounding Types - Valid rounding methods per ORE XML schema (roundingType)
    end note

    entity ores_refdata_supervisory_bodies_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        * coding_scheme_code : text <<PK, FK>>
        --
        * version : integer <<unique>>
          source : text
          description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_refdata_supervisory_bodies_tbl
    Contains a code representing a supervisory-body that may be supervising this transaction.
    end note

}

'
' ==================== dq (Data Quality) ====================
'
package "dq" #E1F5FE {
    entity ores_dq_account_types_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
          source : text
          description : text
    }

    note right of ores_dq_account_types_artefact_tbl
    Contains a code representing the type of an account, for example in a clearing or exchange model. - Artefact Table
    end note

    entity ores_dq_artefact_types_tbl  #F7E5FF {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        --
        * version : integer <<unique>>
        * name : text
          description : text
          artefact_table : text
          target_table : text
          populate_function : text
        * display_order : integer
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_dq_artefact_types_tbl
    Artefact Types - Maps artefact type codes to their population functions and tables
    end note

    entity ores_dq_asset_classes_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
          source : text
          description : text
    }

    note right of ores_dq_asset_classes_artefact_tbl
    Defines a simple asset class categorization. Used for classification of the risk class of the trade. - Artefact Table
    end note

    entity ores_dq_asset_measures_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
          source : text
          description : text
    }

    note right of ores_dq_asset_measures_artefact_tbl
    The type of measure about an asset. Used for escribing valuation, sensitivity, and risk measures. - Artefact Table
    end note

    entity ores_dq_benchmark_rates_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
          source : text
          description : text
    }

    note right of ores_dq_benchmark_rates_artefact_tbl
    FpML Benchmark rates - Artefact Table
    end note

    entity ores_dq_bundle_publications_tbl  #F7E5FF {
        * id : uuid <<PK>>
        --
        * bundle_code : text
        * bundle_name : text
        * mode : text
        * atomic : boolean
        * datasets_processed : integer
        * datasets_succeeded : integer
        * datasets_failed : integer
        * datasets_skipped : integer
        * total_records_inserted : bigint
        * total_records_updated : bigint
        * total_records_skipped : bigint
        * total_records_deleted : bigint
        * published_by : text
        * published_at : timestamptz
          completed_at : timestamptz
    }

    note right of ores_dq_bundle_publications_tbl
    Bundle Publication Audit Table
    end note

    entity ores_dq_business_centres_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
          source : text
          description : text
    }

    note right of ores_dq_business_centres_artefact_tbl
    The coding-scheme accepts a 4 character code of the real geographical business calendar location or FpML format of the rate publication calendar. While the 4 character codes of the business calendar location are implicitly locatable and used for identifying a bad business day for the purpose of payment and rate calculation day adjustments, the rate publication calendar codes are used in the context of the fixing day offsets. - Artefact Table
    end note

    entity ores_dq_business_processes_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
          source : text
          description : text
    }

    note right of ores_dq_business_processes_artefact_tbl
    Contains a code representing the type of business process a message (e.g. a status request) applies to. - Artefact Table
    end note

    entity ores_dq_cashflow_types_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
          source : text
          description : text
    }

    note right of ores_dq_cashflow_types_artefact_tbl
    The type of cash flows associated with OTC derivatives contracts and their lifecycle events. - Artefact Table
    end note

    entity ores_dq_catalogs_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * name : text <<PK>>
        --
        * version : integer
        * description : text
          owner : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_dq_catalogs_tbl
    A catalog is a named collection of related datasets. It provides a
    high-level grouping mechanism for datasets that share a common theme,
    source, or purpose.
    Examples:
    - "ISO Standards" - Contains ISO 3166 countries, ISO 4217 currencies
    - "Cryptocurrency" - Contains crypto reference data and icons
    end note

    entity ores_dq_change_reason_categories_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        --
        * version : integer
        * description : text
        * modified_by : text
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    entity ores_dq_change_reasons_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        --
        * version : integer
        * description : text
        * category_code : text <<FK>>
        * applies_to_amend : boolean
        * applies_to_delete : boolean
        * requires_commentary : boolean
        * display_order : integer
        * modified_by : text
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    entity ores_dq_coding_scheme_authority_types_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        --
        * version : integer
        * name : text
        * description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_dq_coding_scheme_authority_types_tbl
    Classifies coding schemes by the authority or governance level behind them.
    This helps distinguish between formal standards, industry conventions, and
    proprietary identifiers.
    Values:
    - official: Formal standards from recognized standards bodies (ISO, IEEE, etc.)
    - industry: De facto standards widely adopted in the market but not formally standardized
    - internal: Proprietary or organization-specific identifiers
    end note

    entity ores_dq_coding_schemes_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
        * name : text
        * authority_type : text <<FK>>
        * subject_area_name : text
        * domain_name : text
          uri : text
        * description : text
    }

    entity ores_dq_coding_schemes_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        --
        * version : integer
        * name : text
        * authority_type : text <<FK>>
        * subject_area_name : text
        * domain_name : text
          uri : text
        * description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_dq_coding_schemes_tbl
    A scheme defines a coding or identification standard used to identify
    entities such as parties, currencies, or other domain objects. Based on
    the FPML coding-scheme concept.
    Each scheme belongs to a subject area within the DQ hierarchy, establishing
    what type of entity the scheme identifies.
    Examples:
    - LEI (Legal Entity Identifier, ISO 17442) for party identification
    - BIC (Business Identifier Code, ISO 9362) for financial institutions
    - ISO 4217 for currency codes
    - ISO 3166 for country codes
    end note

    entity ores_dq_countries_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * alpha2_code : text
        * version : integer
        * alpha3_code : text
        * numeric_code : text
        * name : text
        * official_name : text
          image_id : uuid <<FK>>
    }

    entity ores_dq_currencies_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * iso_code : text
        * version : integer
        * name : text
        * numeric_code : text
        * symbol : text
        * fraction_symbol : text
        * fractions_per_unit : integer
        * rounding_type : text
        * rounding_precision : integer
        * format : text
        * currency_type : text
          image_id : uuid <<FK>>
    }

    entity ores_dq_data_domains_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * name : text <<PK>>
        --
        * version : integer
        * description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_dq_data_domains_tbl
    High-level data classification.
    Examples: reference_data, market_data, trade_data.
    end note

    entity ores_dq_dataset_bundle_members_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * bundle_code : text <<PK>>
        * dataset_code : text <<PK>>
        --
        * version : integer
        * display_order : integer
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_dq_dataset_bundle_members_tbl
    Junction table linking bundles to their constituent datasets. Uses codes
    for loose coupling - allows declaring membership for datasets that may not
    yet exist in the system.
    Examples:
    - Bundle "slovaris" contains "slovaris.countries", "slovaris.currencies", etc.
    - Bundle "base" contains "iso.countries", "iso.currencies", all FpML datasets
    end note

    entity ores_dq_dataset_bundles_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * id : uuid <<PK>>
        --
        * version : integer
        * code : text
        * name : text
        * description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_dq_dataset_bundles_tbl
    Installing a bundle gets the system into a ready state with a coherent set
    of reference data. Bundles provide a way to group related datasets that
    should be installed together.
    Examples:
    - "slovaris": Synthetic reference data for development and testing
    - "base": Industry-standard reference data (ISO + FpML) for production
    - "crypto": Base system plus cryptocurrency reference data
    end note

    entity ores_dq_dataset_dependencies_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * dataset_code : text <<PK>>
        * dependency_code : text <<PK>>
        --
        * role : text
        * recorded_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_dq_dataset_dependencies_tbl
    Declares dependencies between datasets using stable dataset codes.
    When a dataset is injected into the system, all its dependencies must
    be satisfied first. Dependencies are resolved by code at injection time.
    Note: dependency_code is intentionally NOT a foreign key to allow:
    - Declaring dependencies on datasets that may not exist yet
    - Referencing datasets in external systems
    - Loose coupling with validation at injection time
    Examples:
    - "iso.countries" depends on "assets.country_flags" for visual display
    - "crypto.large" and "crypto.small" depend on "assets.crypto_icons" for icon display
    end note

    entity ores_dq_dataset_publications_tbl  #F7E5FF {
        * id : uuid <<PK>>
        --
        * tenant_id : uuid <<FK>>
        * dataset_id : uuid <<FK>>
        * dataset_code : text
        * mode : text
        * target_table : text
        * records_inserted : bigint
        * records_updated : bigint
        * records_skipped : bigint
        * records_deleted : bigint
        * published_by : text
        * published_at : timestamptz
    }

    note right of ores_dq_dataset_publications_tbl
    Audit table for tracking dataset publication history.
    Records each time a dataset is published to production tables.
    end note

    entity ores_dq_datasets_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * id : uuid <<PK>>
        --
        * version : integer
        * code : text
          catalog_name : text
        * subject_area_name : text
        * domain_name : text
          coding_scheme_code : text <<FK>>
        * origin_code : text <<FK>>
        * nature_code : text <<FK>>
        * treatment_code : text <<FK>>
          methodology_id : uuid <<FK>>
        * name : text
        * description : text
        * source_system_id : text <<FK>>
        * business_context : text
          upstream_derivation_id : uuid <<FK>>
        * lineage_depth : integer
        * as_of_date : timestamptz
        * ingestion_timestamp : timestamptz
          license_info : text
        * artefact_type : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_dq_datasets_tbl
    Central dataset registry with full lineage.
    Tracks provenance via upstream_derivation_id.
    lineage_depth auto-calculated from hierarchy.
    end note

    entity ores_dq_entity_classifications_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
          source : text
          description : text
    }

    note right of ores_dq_entity_classifications_artefact_tbl
    Financial Entity Indicator as defined by the CFTC. - Artefact Table
    end note

    entity ores_dq_image_tags_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * image_id : uuid <<FK>>
        * tag_id : uuid <<FK>>
    }

    entity ores_dq_images_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * image_id : uuid <<FK>>
        * version : integer
        * key : text
        * description : text
        * svg_data : text
    }

    entity ores_dq_ip2country_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * range_start : bigint
        * range_end : bigint
        * country_code : text <<FK>>
    }

    note right of ores_dq_ip2country_artefact_tbl
    Staging table for IPv4 to country mapping data from iptoasn.com.
    Data is imported here first, then promoted to geo_ip2country_tbl.
    end note

    entity ores_dq_local_jurisdictions_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
          source : text
          description : text
    }

    note right of ores_dq_local_jurisdictions_artefact_tbl
    This overrides the countryScheme. Specifies the Local Jurisdiction that applies to a Transaction, for example for the purposes of defining which Local Taxes will apply. - Artefact Table
    end note

    entity ores_dq_methodologies_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * id : uuid <<PK>>
        --
        * version : integer
        * name : text
        * description : text
          logic_reference : text
          implementation_details : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_dq_methodologies_tbl
    Describes transformation/derivation logic.
    Links to documentation and implementation.
    end note

    entity ores_dq_nature_dimensions_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        --
        * version : integer
        * name : text
        * description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_dq_nature_dimensions_tbl
    Describes the nature of data.
    Examples: raw, cleansed, derived.
    end note

    entity ores_dq_origin_dimensions_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        --
        * version : integer
        * name : text
        * description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_dq_origin_dimensions_tbl
    Describes the origin of data.
    Examples: vendor, internal, regulatory.
    end note

    entity ores_dq_party_relationships_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
          source : text
          description : text
    }

    note right of ores_dq_party_relationships_artefact_tbl
    Indicates the relationship between two parties as defined by Hong Kong Monetary Authority (HKMA) Rewrite field 189 - Intragroup. - Artefact Table
    end note

    entity ores_dq_party_roles_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
          source : text
          description : text
    }

    note right of ores_dq_party_roles_artefact_tbl
    Contains a code representing a related party role. This can be extended to provide custom roles. - Artefact Table
    end note

    entity ores_dq_person_roles_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
          source : text
          description : text
    }

    note right of ores_dq_person_roles_artefact_tbl
    Indicates the role of a person in a transaction. - Artefact Table
    end note

    entity ores_dq_regulatory_corporate_sectors_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
          source : text
          description : text
    }

    note right of ores_dq_regulatory_corporate_sectors_artefact_tbl
    Defines the corporate sector under HKMA (Hong Kong Monetary Authority) Rewrite fields 190 - Nature of Counterparty 1 and 191 - Nature of Counterparty 2. - Artefact Table
    end note

    entity ores_dq_reporting_regimes_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
          source : text
          description : text
    }

    note right of ores_dq_reporting_regimes_artefact_tbl
    Contains a code representing a reporting regime under which this transaction may be reported. - Artefact Table
    end note

    entity ores_dq_subject_areas_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * name : text <<PK>>
        * domain_name : text <<PK>>
        --
        * version : integer
        * description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_dq_subject_areas_tbl
    Sub-classification within a data domain.
    Examples: currencies, countries, images.
    end note

    entity ores_dq_supervisory_bodies_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * code : text
        * version : integer
          source : text
          description : text
    }

    note right of ores_dq_supervisory_bodies_artefact_tbl
    Contains a code representing a supervisory-body that may be supervising this transaction. - Artefact Table
    end note

    entity ores_dq_tags_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid <<FK>>
        * tenant_id : uuid <<FK>>
        * tag_id : uuid <<FK>>
        * version : integer
        * name : text
        * description : text
    }

    entity ores_dq_treatment_dimensions_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * code : text <<PK>>
        --
        * version : integer
        * name : text
        * description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_dq_treatment_dimensions_tbl
    Describes how data should be treated.
    Examples: golden, provisional, deprecated.
    end note

}

'
' ==================== variability (Feature Flags) ====================
'
package "variability" #E8F5E9 {
    entity ores_variability_feature_flags_tbl <<temporal>> #C6F0D8 {
        * tenant_id : uuid <<PK, FK>>
        * name : text <<PK>>
        --
        * version : integer
        * enabled : integer
          description : text
        * modified_by : text
        * change_reason_code : text <<FK>>
        * change_commentary : text
        * valid_from : timestamptz
        * valid_to : timestamptz
    }

    note right of ores_variability_feature_flags_tbl
    Feature toggles for runtime configuration.
    Uses name as natural key.
    end note

}

'
' ==================== telemetry (Telemetry & Logging) ====================
'
package "telemetry" #FCE4EC {
    entity ores_telemetry_logs_tbl  #F7E5FF {
        * id : uuid <<PK>>
        * timestamp : timestamptz <<PK>>
        --
        * tenant_id : uuid <<FK>>
        * source : text
        * source_name : text
          session_id : uuid <<FK>>
          account_id : uuid <<FK>>
        * level : text
        * component : text
        * message : text
        * tag : text
        * recorded_at : timestamptz
    }

    note right of ores_telemetry_logs_tbl
    Application log entries.
    Designed for TimescaleDB hypertable.
    Partitioned by timestamp.
    end note

}

'
' ==================== geo (Geolocation) ====================
'
package "geo" #FFF9C4 {
    entity ores_geo_ip2country_tbl  #F7E5FF {
        --
        * ip_range : int8range
        * tenant_id : uuid <<FK>>
        * country_code : text <<FK>>
    }

    note right of ores_geo_ip2country_tbl
    IP range to country code mapping.
    Uses GiST index for fast lookups.
    end note

}


'
' ==================== Relationships ====================
'

' Local Variables:
' compile-command: "java -Djava.awt.headless=true -DPLANTUML_LIMIT_SIZE=131072 -jar /usr/share/plantuml/plantuml.jar ores_schema.puml"
' End:
@enduml
