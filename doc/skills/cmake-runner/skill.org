:PROPERTIES:
:ID: 654d4a70-e63d-4c18-b5a5-886066e36314
:END:
#+title: CMake Runner Skill
#+author: Marco Craveiro
#+options: <:nil c:nil todo:nil ^:nil d:nil date:nil author:nil toc:nil
#+startup: inlineimages
#+export_exclude_tags: noexport

#+begin_export markdown
---
name: cmake-runner
description: Guide for running CMake commands in ORE Studio for building, testing, and deploying.
license: Complete terms in LICENSE.txt
---
#+end_export

* When to use this skill

When you need to configure, build, test, or deploy ORE Studio using CMake.

* How to use this skill

1. Identify what operation you need to perform (configure, build, test,
   deploy, generate diagrams).
2. All commands must be executed from the top-level project directory.
3. Follow the appropriate command from the Detailed instructions section below.
4. Default to =linux-clang-debug= preset when on Linux unless otherwise
   specified.
5. If you need to inspect the output of the build, see section Output directory
   layout.


* Detailed instructions

** Listing and choosing presets

To see all available CMake presets:

#+begin_src sh
cmake --list-presets
#+end_src

The default preset for Linux is =linux-clang-debug=. For release builds, use =linux-clang-release=.

** Configuring the project

To configure the project with a specific preset:

#+begin_src sh
cmake --preset linux-clang-debug
#+end_src

For release configuration:

#+begin_src sh
cmake --preset linux-clang-release
#+end_src

** Building the project

To build the entire project:

#+begin_src sh
cmake --build --preset linux-clang-debug
#+end_src

For release builds:

#+begin_src sh
cmake --build --preset linux-clang-release
#+end_src

** Running tests

*** Running all tests

To run all tests (target name: =rat=):

#+begin_src sh
cmake --build --preset linux-clang-release --target rat
#+end_src

*** Running specific component tests

To run tests for a specific component, use the pattern =test_COMPONENT_NAME=. For example, to run tests for =ores.accounts.tests=:

#+begin_src sh
cmake --build --target test_ores.accounts.tests --preset linux-clang-debug
#+end_src

Replace =ores.accounts.tests= with the desired component name.

*** Configuring test logging

Test logging is disabled by default for performance. To enable logging when debugging test failures, use environment variables:

#+begin_src sh
# Enable logging to files
ORES_TEST_LOG_ENABLED=true cmake --build --target test_ores.accounts.tests --preset linux-clang-debug

# Enable logging with console output
ORES_TEST_LOG_ENABLED=true ORES_TEST_LOG_CONSOLE=true cmake --build --target test_ores.accounts.tests --preset linux-clang-debug

# Change log level (default: trace, options: trace, debug, info, warn, error, fatal)
ORES_TEST_LOG_ENABLED=true ORES_TEST_LOG_LEVEL=debug cmake --build --target test_ores.accounts.tests --preset linux-clang-debug
#+end_src

Available environment variables:
- =ORES_TEST_LOG_ENABLED=: Enable/disable logging (default: =false=)
- =ORES_TEST_LOG_LEVEL=: Log severity level (default: =trace=)
- =ORES_TEST_LOG_CONSOLE=: Output logs to console (default: =false=)

** Deploying skills

To deploy Claude Code skills:

#+begin_src sh
cmake --build --target deploy_skills --preset linux-clang-debug
#+end_src

** Generating PlantUML Diagrams

*** Generating all diagrams

To generate all PlantUML diagrams for the project:

#+begin_src sh
cmake --build --target mad --preset linux-clang-debug
#+end_src

*** Generating individual component diagrams

To generate a diagram for a specific component, use the pattern
=generate_COMPONENT_diagram= where =COMPONENT= is the component name (with dots).

For example, to generate the ores.refdata diagram:

#+begin_src sh
cmake --build --target generate_ores.refdata_diagram --preset linux-clang-debug
#+end_src

To generate the ores.comms diagram:

#+begin_src sh
cmake --build --target generate_ores.comms_diagram --preset linux-clang-debug
#+end_src

Other available diagram targets include:
- =generate_ores.accounts_diagram=
- =generate_ores.utility_diagram=
- =generate_ores_diagram= (system-level architecture diagram)

** Deploying the site

To deploy the project website:

#+begin_src sh
cmake --build --target deploy_site --preset linux-clang-debug
#+end_src


* Output directory layout

The build output directory lives under =build/output=. There is a top-level
directory for the presets (e.g. =linux-clang-debug=, etc) and a top-level
directory for the site called =site=.

Within the preset directory:

- binaries are located under =publish/bin=.
- logs for applications are under =publish/log=.
- logs for tests are organised as follows:
  - they are under =publish/log/COMPONENT_TESTS= where =COMPONENT_TESTS=
    is the name of the component under test, e.g. =ores.accounts.tests=.
  - Inside, there is one folder per test suite, e.g. =domain_account_tests=,
    =domain_feature_flags_tests=, and so on. These must match the test suite
    implementation files (e.g.
    =projects/ores.accounts/tests/domain_account_tests.cpp=).
  - Inside the test suite folder, there is one log file per test, e.g.
    =account_serialization_to_json.log=. This must match the name of the unit
    test, e.g. =TEST_CASE("account_serialization_to_json", tags) {= in
    =projects/ores.accounts/tests/domain_account_tests.cpp=.

* Artefacts                                                        :noexport:

** Licence

#+BEGIN_SRC fundamental :tangle LICENCE.txt
This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
MA 02110-1301, USA.
#+END_SRC
