{{! Template to generate SQL with enhanced GPL v3 license and tag data }}
{{{sql_license}}}

set schema 'ores';

-- =============================================================================
-- Data Quality Slovaris Tags
-- =============================================================================

\echo '--- Data Quality Slovaris Tags ---'

{{#tags}}
select metadata.upsert_dq_tag(
    '{{dataset_name}}',
    '{{subject_area_name}}',
    '{{domain_name}}',
    '{{tag_name}}',
    '{{tag_description}}'
);
{{/tags}}

-- =============================================================================
-- Summary
-- =============================================================================

\echo ''
\echo '--- Summary ---'

select 'dq_datasets' as entity, count(*) as count
from metadata.dq_datasets_tbl
where valid_to = public.utility_infinity_timestamp_fn()
union all
select 'dq_tags_artefact', count(*)
from metadata.dq_tags_artefact_tbl;
