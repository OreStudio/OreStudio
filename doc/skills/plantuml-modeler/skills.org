:PROPERTIES:
:ID: D6D86317-4961-6754-A6DB-9C12B5FAC997
:END:
#+title: PlantUML Modeler Skill
#+author: Marco Craveiro
#+options: title:nil <:nil c:nil todo:nil ^:nil d:nil date:nil author:nil toc:nil
#+startup: inlineimages
#+export_file_name: SKILL
#+export_exclude_tags: noexport

#+begin_export markdown
---
name: plantuml-modeler
description: Guide for creating plantuml class diagrams for ORE Studio components.
license: Complete terms in LICENSE.txt
---
#+end_export

* When to use this skill

When the user requests an updated PlantUML diagram for a specific component
within ORE Studio.

* How to use this skill

1. *Identify the component type* from the request. The component type must exist
   as a project under the folder projects. If it does not, tell the user of the
   error. An example of a component is =ores.utility=.
2. Follow the rules under Detailed instructions to generate the diagram.

* Detailed instructions

** Filesystem instructions

These instructions are related to the filesystem aspects of PlantUML diagram
generation.

*** PlantUML File name

Generated diagrams will have the name of the component as the file name and the
extension =.puml=.

*** PlantUML file location

PlantUML diagrams should be written into a directory called =modeling= under the
component we are modeling. For example =ores.utility/modeling=.

*** Input files to process

In order to determine which files to process, follow these rules:

1. Only consider the C++ header files =.hpp= of a given component for the
   purposes of generating PlantUML diagrams. Implementation files =.cpp= must be
   excluded.
2. Do not follow includes in the header files. Just read each header file within
   a component and model the entities within, unless this file explicitly tells
   you to exclude them.

** PlantUML file layout

These instructions describe the taxonomy of all PlantUML diagrams.

*** Preamble

The preamble is placed at the start of the PlantUML file. The PlantUML file must
have the following preamble:

#+begin_src plantuml
' -*- mode: plantuml; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-
'
' Copyright (C) 2024 Marco Craveiro <marco.craveiro@gmail.com>
'
' This program is free software; you can redistribute it and/or modify it under
' the terms of the GNU General Public License as published by the Free Software
' Foundation; either version 3 of the License, or (at your option) any later
' version.
'
' This program is distributed in the hope that it will be useful, but WITHOUT
'  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
' FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
'
' You should have received a copy of the GNU General Public License along with
' GNU Emacs; see the file COPYING. If not, write to the Free Software
' Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
@startuml
#+end_src

Update the year to match the current year.

*** Postamble

The postamble is placed at the end of the PlantUML file. The PlantUML file
should have the following postamble:

#+begin_src plantuml
' Local Variables:
' compile-command: "java -Djava.awt.headless=true -DPLANTUML_SECURITY_PROFILE=UNSECURE -DPLANTUML_LIMIT_SIZE=65535 -jar /usr/share/plantuml/plantuml.jar ORESTUDIO_COMPONENT"
' End:
@enduml
#+end_src

Where =ORESTUDIO_COMPONENT= is the name of the component for which the diagram
is being generated, with the extension =.puml=. For example =ores.utility.puml=.

*** Body

Place all of the PlantUML code describing the entities of the component between
the Preamble and Postamble in the body of the diagram.

Follow these instructions to model the entities within the body:

**** Entity selection

Only document entities that belong to the current component. Ignore all other
entities.

**** Namespaces

Follow these rules when modeling namespaces:

1. Always use nested namespaces rather than inlined namespaces.
2. Colour namespaces with #F2F2F2.
3. Document each namespace with a UML note before it's definition, except the
   top-level =ores= namespace which is never documented.
4. Documentation is obtained from the namespace header file, which is a file
   that has the name of the namespace. Example: =ores.utility.hpp=. If the
   namespace header file does not exist, do not document it.

Example:

#+begin_src plantuml
namespace ores #F2F2F2 {
    note "Contains assorted basic functionality that does not fit elsewhere." as ores_utility_note
    utility --- ores_utility_note
    namespace utility #F2F2F2 {
        note "Generic exception classes" as ores_utility_exception_note
        exception --- ores_utility_exception_note
        namespace exception #F2F2F2 {
            ' namespace contents
        }
    }
}
#+end_src

**** Structs and Classes

Follow these rules when modeling structs:

1. Ignore =operator<<=.
2. Structs are normally expected to only have data members. Colour structs with
   #F7E5FF.
3. Classes are normally expected to have behaviour. Colour classes as #FFFACD.
4. Ignore default values.
5. Model a =struct= by adding all of the fields.
6. Add a UML note documenting structs and classes after the struct or class. Add
   the top-level comments, followed by the comments for each field to the note.
7. Add the relevant relationships after the class. Ignore relationships to types
   outside the current component. Use the fully qualified entity name in the
   relationship. Use the appropriate UML relationship from the PlantUML
   vocabulary.

#+begin_src plantuml
note top of options
Stores the options for the system.

Fields:

- name: Name of the option.
- kvps: Key value pairs used in the options.
- config: database configuration used.
end note

class options #F7E5FF {
    +{field} name std::string
    +{field} kvps std::unordered_map<std::string, std::list<std::string>>
    +{field} config ores::utility::database_configuration
}
options o-u- ores::utility::database_configuration
#+end_src


* Artefacts                                                        :noexport:

** Licence

#+BEGIN_SRC fundamental :tangle LICENCE.txt
This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
MA 02110-1301, USA.
#+END_SRC
