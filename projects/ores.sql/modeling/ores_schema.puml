' -*- mode: plantuml; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-
'
' Copyright (C) 2025 Marco Craveiro <marco.craveiro@gmail.com>
'
' This program is free software; you can redistribute it and/or modify it under
' the terms of the GNU General Public License as published by the Free Software
' Foundation; either version 3 of the License, or (at your option) any later
' version.
'
' This program is distributed in the hope that it will be useful, but WITHOUT
'  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
' FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
'
' You should have received a copy of the GNU General Public License along with
' GNU Emacs; see the file COPYING. If not, write to the Free Software
' Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
'
' GENERATED FILE - DO NOT EDIT
' Generated: 2026-01-24T12:54:03.820465Z
' Regenerate with: ./projects/ores.codegen/plantuml_er_generate.sh
'
@startuml

title ORES Database Schema
hide circle
skinparam linetype ortho

note as SchemaNote
ORES Database Schema

All temporal tables use valid_from/valid_to
for bitemporal data management. Junction tables enable
soft deletes via validity period closure.

Change tracking: Most entities include change_reason_code
and change_commentary for audit trail support.

Table naming: <component>_<entity>_tbl
end note

'
' ==================== assets (Digital Assets) ====================
'
package "assets" #F3E5F5 {
    entity assets_image_tags_tbl <<junction>> #ECECEC {
        * image_id : uuid <<PK>>
        * tag_id : uuid <<PK>>
        * valid_from : timestamptz <<PK>>
        --
        * assigned_by : text
        * assigned_at : timestamptz
        * valid_to : timestamptz
    }

    entity assets_images_tbl <<temporal>> #C6F0D8 {
        * image_id : uuid <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * key : text
        * description : text
        * svg_data : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity assets_tags_tbl <<temporal>> #C6F0D8 {
        * tag_id : uuid <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * name : text
        * description : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

}

'
' ==================== dq (Data Quality) ====================
'
package "dq" #E1F5FE {
    entity dq_account_types_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
          source : text
          description : text
    }

    entity dq_asset_classes_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
          source : text
          description : text
    }

    entity dq_asset_measures_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
          source : text
          description : text
    }

    entity dq_benchmark_rates_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
          source : text
          description : text
    }

    entity dq_business_centres_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
          source : text
          description : text
    }

    entity dq_business_processes_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
          source : text
          description : text
    }

    entity dq_cashflow_types_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
          source : text
          description : text
    }

    entity dq_catalogs_tbl <<temporal>> #C6F0D8 {
        * name : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * description : text
          owner : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity dq_change_reason_categories_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * description : text
        * modified_by : text
        * change_commentary : text
    }

    entity dq_change_reasons_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * description : text
        * category_code : text
        * applies_to_amend : boolean
        * applies_to_delete : boolean
        * requires_commentary : boolean
        * display_order : integer
        * modified_by : text
        * change_commentary : text
    }

    entity dq_coding_scheme_authority_types_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * name : text
        * description : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity dq_coding_schemes_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
        * name : text
        * authority_type : text
        * subject_area_name : text
        * domain_name : text
          uri : text
        * description : text
    }

    entity dq_coding_schemes_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * name : text
        * authority_type : text
        * subject_area_name : text
        * domain_name : text
          uri : text
        * description : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity dq_countries_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * alpha2_code : text
        * version : integer
        * alpha3_code : text
        * numeric_code : text
        * name : text
        * official_name : text
          image_id : uuid
    }

    entity dq_currencies_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * iso_code : text
        * version : integer
        * name : text
        * numeric_code : text
        * symbol : text
        * fraction_symbol : text
        * fractions_per_unit : integer
        * rounding_type : text
        * rounding_precision : integer
        * format : text
        * currency_type : text
          image_id : uuid
    }

    entity dq_data_domains_tbl <<temporal>> #C6F0D8 {
        * name : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * description : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity dq_dataset_dependencies_tbl <<temporal>> #C6F0D8 {
        * dataset_code : text <<PK>>
        * dependency_code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        --
        * role : text
        * recorded_by : text
        * change_reason_code : text
        * change_commentary : text
        * valid_to : timestamptz
    }

    entity dq_datasets_tbl <<temporal>> #C6F0D8 {
        * id : uuid <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * code : text
          catalog_name : text
        * subject_area_name : text
        * domain_name : text
          coding_scheme_code : text
        * origin_code : text
        * nature_code : text
        * treatment_code : text
          methodology_id : uuid
        * name : text
        * description : text
        * source_system_id : text
        * business_context : text
          upstream_derivation_id : uuid
        * lineage_depth : integer
        * as_of_date : timestamptz
        * ingestion_timestamp : timestamptz
          license_info : text
          artefact_type : text
          target_table : text
          populate_function : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity dq_entity_classifications_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
          source : text
          description : text
    }

    entity dq_image_tags_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * image_id : uuid
        * tag_id : uuid
    }

    entity dq_images_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * image_id : uuid
        * version : integer
        * key : text
        * description : text
        * svg_data : text
    }

    entity dq_ip2country_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * range_start : bigint
        * range_end : bigint
        * country_code : text
    }

    entity dq_local_jurisdictions_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
          source : text
          description : text
    }

    entity dq_methodologies_tbl <<temporal>> #C6F0D8 {
        * id : uuid <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * name : text
        * description : text
          logic_reference : text
          implementation_details : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity dq_nature_dimensions_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * name : text
        * description : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity dq_origin_dimensions_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * name : text
        * description : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity dq_party_relationships_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
          source : text
          description : text
    }

    entity dq_party_roles_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
          source : text
          description : text
    }

    entity dq_person_roles_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
          source : text
          description : text
    }

    entity dq_publications_tbl  #F7E5FF {
        * id : uuid <<PK>>
        --
        * dataset_id : uuid
        * dataset_code : text
        * mode : text
        * target_table : text
        * records_inserted : bigint
        * records_updated : bigint
        * records_skipped : bigint
        * records_deleted : bigint
        * published_by : text
        * published_at : timestamptz
    }

    entity dq_regulatory_corporate_sectors_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
          source : text
          description : text
    }

    entity dq_reporting_regimes_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
          source : text
          description : text
    }

    entity dq_subject_areas_tbl <<temporal>> #C6F0D8 {
        * name : text <<PK>>
        * domain_name : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * description : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity dq_supervisory_bodies_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * code : text
        * version : integer
          source : text
          description : text
    }

    entity dq_tags_artefact_tbl  #F7E5FF {
        --
        * dataset_id : uuid
        * tag_id : uuid
        * version : integer
        * name : text
        * description : text
    }

    entity dq_treatment_dimensions_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * name : text
        * description : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

}

'
' ==================== geo (Geolocation) ====================
'
package "geo" #FFF9C4 {
    entity geo_ip2country_tbl  #F7E5FF {
        --
        * ip_range : int8range
        * country_code : text
    }

}

'
' ==================== iam (Identity & Access Management) ====================
'
package "iam" #E8F4FD {
    entity iam_account_roles_tbl <<temporal>> #C6F0D8 {
        * account_id : uuid <<PK>>
        * role_id : uuid <<PK>>
        * valid_from : timestamptz <<PK>>
        --
        * assigned_by : text
        * assigned_at : timestamptz
        * change_reason_code : text
        * change_commentary : text
        * valid_to : timestamptz
    }

    entity iam_accounts_tbl <<temporal>> #C6F0D8 {
        * id : uuid <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * username : text
        * password_hash : text
        * password_salt : text
        * totp_secret : text
        * email : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity iam_login_info_tbl  #F7E5FF {
        * account_id : uuid <<PK>>
        --
        * last_ip : inet
        * last_attempt_ip : inet
        * failed_logins : integer
        * locked : integer
        * last_login : timestamptz
        * online : integer
        * password_reset_required : integer
    }

    entity iam_permissions_tbl <<temporal>> #C6F0D8 {
        * id : uuid <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * code : text
        * description : text
    }

    entity iam_role_permissions_tbl <<junction>> #ECECEC {
        * role_id : uuid <<PK>>
        * permission_id : uuid <<PK>>
        * valid_from : timestamptz <<PK>>
        --
        * valid_to : timestamptz
    }

    entity iam_roles_tbl <<temporal>> #C6F0D8 {
        * id : uuid <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * name : text
        * description : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity iam_sessions_tbl  #F7E5FF {
        * id : uuid <<PK>>
        * start_time : timestamptz <<PK>>
        --
        * account_id : uuid
        * end_time : text
        * client_ip : text
        * client_identifier : text
        * client_version_major : smallint
        * client_version_minor : smallint
        * bytes_sent : bigint
        * bytes_received : bigint
        * country_code : text
        * protocol : text
    }

}

'
' ==================== refdata (Reference Data) ====================
'
package "refdata" #FFF3E0 {
    entity refdata_account_types_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
          source : text
          description : text
        * coding_scheme_code : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_asset_classes_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
          source : text
          description : text
        * coding_scheme_code : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_asset_measures_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
          source : text
          description : text
        * coding_scheme_code : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_benchmark_rates_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
          source : text
          description : text
        * coding_scheme_code : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_business_centres_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
          source : text
          description : text
        * coding_scheme_code : text
          image_id : uuid
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_business_processes_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
          source : text
          description : text
        * coding_scheme_code : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_cashflow_types_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
          source : text
          description : text
        * coding_scheme_code : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_countries_tbl <<temporal>> #C6F0D8 {
        * alpha2_code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * alpha3_code : text
        * numeric_code : text
        * name : text
        * official_name : text
          coding_scheme_code : text
          image_id : uuid
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_currencies_tbl <<temporal>> #C6F0D8 {
        * iso_code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * name : text
        * numeric_code : text
        * symbol : text
        * fraction_symbol : text
        * fractions_per_unit : integer
        * rounding_type : text
        * rounding_precision : integer
        * format : text
        * currency_type : text
          coding_scheme_code : text
          image_id : uuid
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_entity_classifications_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
          source : text
          description : text
        * coding_scheme_code : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_local_jurisdictions_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
          source : text
          description : text
        * coding_scheme_code : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_party_relationships_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
          source : text
          description : text
        * coding_scheme_code : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_party_roles_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
          source : text
          description : text
        * coding_scheme_code : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_person_roles_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
          source : text
          description : text
        * coding_scheme_code : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_regulatory_corporate_sectors_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
          source : text
          description : text
        * coding_scheme_code : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_reporting_regimes_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
          source : text
          description : text
        * coding_scheme_code : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

    entity refdata_supervisory_bodies_tbl <<temporal>> #C6F0D8 {
        * code : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
          source : text
          description : text
        * coding_scheme_code : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

}

'
' ==================== telemetry (Telemetry & Logging) ====================
'
package "telemetry" #FCE4EC {
    entity telemetry_logs_tbl  #F7E5FF {
        * id : uuid <<PK>>
        * timestamp : timestamptz <<PK>>
        --
        * source : text
        * source_name : text
          session_id : uuid
          account_id : uuid
        * level : text
        * component : text
        * message : text
        * tag : text
        * recorded_at : timestamptz
    }

}

'
' ==================== variability (Feature Flags) ====================
'
package "variability" #E8F5E9 {
    entity variability_feature_flags_tbl <<temporal>> #C6F0D8 {
        * name : text <<PK>>
        * valid_from : timestamptz <<PK>>
        * valid_to : timestamptz <<PK>>
        --
        * version : integer
        * enabled : integer
          description : text
        * modified_by : text
        * change_reason_code : text
        * change_commentary : text
    }

}


' Local Variables:
' compile-command: "java -Djava.awt.headless=true -DPLANTUML_SECURITY_PROFILE=UNSECURE -DPLANTUML_LIMIT_SIZE=65535 -jar /usr/share/plantuml/plantuml.jar ores_schema.puml"
' End:
@enduml
