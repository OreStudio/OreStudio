' -*- mode: plantuml; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*-
'
' Copyright (C) 2025 Marco Craveiro <marco.craveiro@gmail.com>
'
' This program is free software; you can redistribute it and/or modify it under
' the terms of the GNU General Public License as published by the Free Software
' Foundation; either version 3 of the License, or (at your option) any later
' version.
'
' This program is distributed in the hope that it will be useful, but WITHOUT
'  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
' FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
'
' You should have received a copy of the GNU General Public License along with
' GNU Emacs; see the file COPYING. If not, write to the Free Software
' Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
@startuml
!pragma layout smetana

title ores.utility Component

set namespaceSeparator ::

namespace ores #F2F2F2 {
    namespace utility #F2F2F2 {
        namespace string #F2F2F2 {
            '
            ' Layout groupings
            '

            together {
                class conversion_error
                class converter
            }

            conversion_error -[hidden]down- converter

            '
            ' Class definitions
            '

            class conversion_error <<exception>> #D6B19F {
            }

            note top of conversion_error
            An error occurred whilst converting a string.
            end note

            class converter #ECECEC {
                +{static} string_to_int(std::string, int) int
            }

            note top of converter
            Type conversion utilities.

            Methods:

            - string_to_int: Converts a string into an integer.
            end note
        }

        namespace streaming #F2F2F2 {
        }

        ' Note: Logging functionality has been moved to ores.telemetry.
        ' See projects/ores.telemetry/modeling/ores.telemetry.puml

        namespace uuid #F2F2F2 {
            class uuid_v7_generator #ECECEC {
                +operator()() boost::uuids::uuid
            }

            note top of uuid_v7_generator
            A generator for UUID version 7 (v7) based on RFC 9562.

            This class creates UUIDs that are time-sortable and contain
            high-entropy random data. A UUID v7 is composed of a 48-bit Unix timestamp
            (in milliseconds), a 4-bit version field, and 74 bits of random data.

            The combination of a timestamp and random data makes v7 UUIDs excellent for
            use as primary keys in distributed databases, as they are sortable by
            generation time and have a very low probability of collision.

            This implementation is designed to be efficient, creating and seeding a
            random number engine only once upon construction.

            Fields:

            - random_engine: The Mersenne Twister 19937 64-bit random number engine.
            end note
        }

        namespace program_options #F2F2F2 {
            class environment_mapper_factory #ECECEC {
                +{static} make_mapper(const std::string) std::function<std::string(const std::string&)>
            }

            note top of environment_mapper_factory
            Makes environment mappers for program options.

            Note: Logging is not available during configuration.

            Methods:

            - make_mapper: Creates an environment variable name mapping function.
            end note
        }

        namespace rfl #F2F2F2 {
        }

        namespace serialization #F2F2F2 {
            '
            ' Layout groupings
            '

            together {
                enum error_code
                class reader
                class writer
            }

            error_code -[hidden]down- reader
            reader -[hidden]down- writer

            '
            ' Class definitions
            '

            enum error_code #F2DAFD {
                none
                version_mismatch
                crc_validation_failed
                invalid_message_type
                handshake_timeout
                handshake_failed
                payload_too_large
                network_error
                handler_error
                database_error
                authentication_failed
                authorization_failed
                invalid_request
                bootstrap_mode_only
                bootstrap_mode_forbidden
                weak_password
                not_localhost
                database_unavailable
                decompression_failed
                unsupported_compression
                compression_failed
                signup_disabled
                username_taken
                email_taken
                signup_requires_authorization
                payload_incomplete
            }

            note top of error_code
            Error codes used during message serialization and deserialization.

            These codes indicate specific failures that can occur when reading or
            writing binary protocol data, as well as higher-level protocol errors.
            end note

            class reader #ECECEC {
                +{static} read_uint8(std::span<const std::byte>&) std::expected<std::uint8_t, error_code>
                +{static} read_uint16(std::span<const std::byte>&) std::expected<std::uint16_t, error_code>
                +{static} read_uint32(std::span<const std::byte>&) std::expected<std::uint32_t, error_code>
                +{static} read_int64(std::span<const std::byte>&) std::expected<std::int64_t, error_code>
                +{static} read_uint64(std::span<const std::byte>&) std::expected<std::uint64_t, error_code>
                +{static} read_string(std::span<const std::byte>&) std::expected<std::string, error_code>
                +{static} read_uuid(std::span<const std::byte>&) std::expected<boost::uuids::uuid, error_code>
                +{static} read_bool(std::span<const std::byte>&) std::expected<bool, error_code>
            }

            note top of reader
            Helper class to read binary data in network byte order.

            Provides static methods to deserialize various data types from a byte span.
            All multi-byte integers are read in big-endian (network) byte order.
            The span is advanced past the read data on success.
            end note

            class writer #ECECEC {
                +{static} write_uint8(std::vector<std::byte>&, std::uint8_t) void
                +{static} write_uint16(std::vector<std::byte>&, std::uint16_t) void
                +{static} write_uint32(std::vector<std::byte>&, std::uint32_t) void
                +{static} write_int64(std::vector<std::byte>&, std::int64_t) void
                +{static} write_uint64(std::vector<std::byte>&, std::uint64_t) void
                +{static} write_string(std::vector<std::byte>&, const std::string&) void
                +{static} write_bool(std::vector<std::byte>&, bool) void
                +{static} write_uuid(std::vector<std::byte>&, const boost::uuids::uuid&) void
            }

            note top of writer
            Helper class to write binary data in network byte order.

            Provides static methods to serialize various data types into a byte buffer.
            All multi-byte integers are written in big-endian (network) byte order.
            end note

            ' Relationships
            ores::utility::serialization::reader ..> ores::utility::serialization::error_code : returns
        }

        namespace tests #F2F2F2 {
            '
            ' Layout groupings
            '

            ' Group: Converter tests
            together {
                class convert_base32_converter_tests
                class convert_base64_converter_tests
                class string_converter_tests
            }

            ' Group: Other tests
            together {
                class faker_internet_tests
                class faker_totp_tests
                class uuid_uuid_v7_generator_tests
            }

            ' Stack vertically
            convert_base32_converter_tests -[hidden]down- convert_base64_converter_tests
            convert_base64_converter_tests -[hidden]down- string_converter_tests
            faker_internet_tests -[hidden]down- faker_totp_tests
            faker_totp_tests -[hidden]down- uuid_uuid_v7_generator_tests

            '
            ' Class definitions
            '

            class convert_base32_converter_tests <<test suite>> #C5E1A5 {
                +base32_encode_empty_input() void
                +base32_encode_single_byte() void
                +base32_encode_hello() void
                +base32_encode_foobar() void
                +base32_encode_various_lengths() void
                +base32_encode_binary_data() void
                +base32_encode_all_zeros() void
                +base32_encode_alphabet_coverage() void
            }

            note top of convert_base32_converter_tests
            Test suite for base32 encoding functionality.

            Tests cover empty input, single byte, text strings,
            various length inputs, binary data, and alphabet coverage.
            end note

            class convert_base64_converter_tests <<test suite>> #C5E1A5 {
                +base64_encode_empty_input() void
                +base64_encode_hello() void
                +base64_encode_hello_world() void
                +base64_decode_hello() void
                +base64_roundtrip_conversion() void
                +base64_encode_binary_data() void
                +base64_roundtrip_binary_data() void
                +base64_decode_empty_throws() void
                +base64_encode_various_lengths() void
                +base64_encode_long_text() void
                +base64_encode_all_zeros() void
                +base64_encode_all_ones() void
            }

            note top of convert_base64_converter_tests
            Test suite for base64 encoding/decoding functionality.

            Tests cover encoding, decoding, roundtrip conversions,
            binary data, various length inputs, and error handling.
            end note

            class faker_internet_tests <<test suite>> #C5E1A5 {
                +internet_endpoint_format() void
                +internet_endpoint_port_range() void
                +internet_endpoint_unique_values() void
                +internet_ipv4_is_valid() void
                +internet_ipv4_to_string_format() void
                +internet_ipv4_octets_in_range() void
                +internet_ipv4_unique_values() void
                +internet_ipv4_can_create_address() void
                +internet_endpoint_multiple_calls() void
                +internet_ipv4_not_unspecified() void
            }

            note top of faker_internet_tests
            Test suite for faker internet data generation.

            Tests cover endpoint generation (format, port range),
            IPv4 generation (validation, format, uniqueness),
            and address creation.
            end note

            class faker_totp_tests <<test suite>> #C5E1A5 {
                +totp_secret_default_size() void
                +totp_secret_custom_size_10() void
                +totp_secret_custom_size_5() void
                +totp_secret_custom_size_32() void
                +totp_secret_is_valid_base32() void
                +totp_secret_generates_unique_values() void
                +totp_secret_different_sizes_produce_different_lengths() void
                +totp_secret_standard_size_16() void
                +totp_secret_very_small_size() void
                +totp_secret_multiple_calls_different_results() void
            }

            note top of faker_totp_tests
            Test suite for faker TOTP secret generation.

            Tests cover default and custom secret sizes, base32
            validation, uniqueness, and multiple generation calls.
            end note

            class string_converter_tests <<test suite>> #C5E1A5 {
                +string_to_int_valid_decimal() void
                +string_to_int_negative_number() void
                +string_to_int_zero() void
                +string_to_int_hexadecimal() void
                +string_to_int_hex_lowercase() void
                +string_to_int_binary() void
                +string_to_int_octal() void
                +string_to_int_max_int() void
                +string_to_int_min_int() void
                +string_to_int_invalid_empty_string() void
                +string_to_int_invalid_non_numeric() void
                +string_to_int_partial_parse_stops_at_invalid() void
                +string_to_int_invalid_whitespace() void
                +string_to_int_out_of_range_overflow() void
                +string_to_int_out_of_range_underflow() void
                +string_to_int_different_bases() void
                +string_to_int_partial_parse_binary() void
                +string_to_int_partial_parse_hex() void
                +string_to_int_large_hex_value() void
                +string_to_int_negative_hex() void
            }

            note top of string_converter_tests
            Test suite for string converter functionality.

            Tests cover decimal, hexadecimal, binary, and octal
            conversions, boundary values, error handling,
            and different number bases.
            end note

            string_converter_tests ..> ores::utility::string::converter : tests

            class uuid_uuid_v7_generator_tests <<test suite>> #C5E1A5 {
                +generate_uuid_v7_is_not_nil() void
                +generate_multiple_unique_uuids() void
                +uuid_v7_has_correct_version() void
                +uuid_v7_has_correct_variant() void
                +uuid_v7_preserves_time_ordering() void
                +uuid_v7_string_format_is_valid() void
                +uuid_v7_timestamp_extraction() void
                +generate_batch_of_time_ordered_uuids() void
                +uuid_v7_format_components() void
            }

            note top of uuid_uuid_v7_generator_tests
            Test suite for UUID v7 generator.

            Tests cover UUID generation, uniqueness, version/variant
            validation, time ordering, string format, and timestamp
            extraction.
            end note

            uuid_uuid_v7_generator_tests ..> ores::utility::uuid::uuid_v7_generator : tests
        }
    }
}

' Local Variables:
' compile-command: "java -Djava.awt.headless=true -DPLANTUML_SECURITY_PROFILE=UNSECURE -DPLANTUML_LIMIT_SIZE=65535 -jar /usr/share/plantuml/plantuml.jar ores.utility.puml"
' End:
@enduml
