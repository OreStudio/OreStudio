:PROPERTIES:
:ID: 5A85BDB5-E915-3A44-04AB-771ACE91992B
:END:
#+title: Sprint Backlog 04
#+options: <:nil c:nil ^:nil d:nil date:nil author:nil toc:nil html-postamble:nil
#+todo: STARTED | COMPLETED CANCELLED POSTPONED BLOCKED
#+tags: { code(c) infra(i) analysis(n) agile(a) }
#+startup: inlineimages

* Sprint Mission

- implement bootstrap mode.
- implement claude code skills for common functionality.

* Stories

** Active

#+begin: clocktable :maxlevel 3 :scope subtree :tags t :indent nil :emphasize nil :scope file :narrow 75 :formula % :block today
#+TBLNAME: today_summary
#+CAPTION: Clock summary at [2025-11-14 Fri 20:31], for Friday, November 14, 2025.
|      | <75>                                       |        |      |      |       |
| Tags | Headline                                   | Time   |      |      |     % |
|------+--------------------------------------------+--------+------+------+-------|
|      | *Total time*                               | *2:34* |      |      | 100.0 |
|------+--------------------------------------------+--------+------+------+-------|
|      | Stories                                    | 2:34   |      |      | 100.0 |
|      | Active                                     |        | 2:34 |      | 100.0 |
| code | Consider adding tags to catch2 tests       |        |      | 0:34 |  22.1 |
| code | Fix the valgrind leaks reported on sqlgen  |        |      | 1:54 |  74.0 |
| code | Review all code created so far with an LLM |        |      | 0:06 |   3.9 |
#+end:

#+begin: clocktable :maxlevel 3 :scope subtree :tags t :indent nil :emphasize nil :scope file :narrow 75 :formula %
#+TBLNAME: sprint_summary
#+CAPTION: Clock summary at [2025-11-14 Fri 20:31]
|          | <75>                                                   |         |       |       |       |
| Tags     | Headline                                               | Time    |       |       |     % |
|----------+--------------------------------------------------------+---------+-------+-------+-------|
|          | *Total time*                                           | *66:37* |       |       | 100.0 |
|----------+--------------------------------------------------------+---------+-------+-------+-------|
|          | Stories                                                | 66:37   |       |       | 100.0 |
|          | Active                                                 |         | 66:37 |       | 100.0 |
| agile    | Sprint and product backlog refinement                  |         |       |  2:49 |   4.2 |
| code     | Clean up client parser                                 |         |       |  0:10 |   0.3 |
| code     | Add connect command line argument                      |         |       |  1:19 |   2.0 |
| infra    | Install Windows package on Windows machine             |         |       |  2:09 |   3.2 |
| code     | Ignore warnings on windows and osx                     |         |       |  0:33 |   0.8 |
| code     | Ensure applications work under OSX using github images |         |       |  0:14 |   0.4 |
| infra    | Create a splash screen and gray background             |         |       |  2:26 |   3.7 |
| code     | Use fluent icons                                       |         |       |  0:37 |   0.9 |
| code     | Add export functionality for currencies                |         |       |  1:30 |   2.3 |
| code     | Add currency editing support                           |         |       |  2:45 |   4.1 |
| code     | Add about to menu                                      |         |       |  1:02 |   1.6 |
| code     | Create a history dialog for currencies                 |         |       |  1:27 |   2.2 |
| code     | Allow MDI windows outside main window                  |         |       |  1:35 |   2.4 |
| code     | Add edit menu and export menu                          |         |       |  0:34 |   0.9 |
| code     | Implement adding new currencies                        |         |       |  3:17 |   4.9 |
| code     | Clean up product website                               |         |       |  4:42 |   7.1 |
| code     | Create a skill for plant uml documentation             |         |       |  2:48 |   4.2 |
| infra    | Add CMake targets for site and skills                  |         |       |  0:17 |   0.4 |
| infra    | Generalise the skill setup for ORE Studio              |         |       |  3:45 |   5.6 |
| infra    | Restructure components to follow the dogen approach    |         |       |  2:54 |   4.4 |
| infra    | Generate PlantUML diagrams for all components          |         |       |  1:05 |   1.6 |
| analysis | Weaving skills and documentation together              |         |       |  0:46 |   1.2 |
| code     | Consider adding tags to catch2 tests                   |         |       |  0:34 |   0.9 |
| code     | Fix the valgrind leaks reported on sqlgen              |         |       |  4:54 |   7.4 |
| code     | Make UI/UX look more professional                      |         |       | 11:07 |  16.7 |
| code     | Current issues with package install in debian          |         |       |  0:40 |   1.0 |
| code     | Resolve crash on shutdown problem                      |         |       |  0:50 |   1.3 |
| code     | Review all code created so far with an LLM             |         |       |  9:48 |  14.7 |
#+end:

*** STARTED Sprint and product backlog refinement                     :agile:
    :LOGBOOK:
    CLOCK: [2025-11-12 Wed 17:45]--[2025-11-12 Wed 18:01] =>  0:16
    CLOCK: [2025-11-11 Tue 22:38]--[2025-11-11 Tue 23:09] =>  0:31
    CLOCK: [2025-11-11 Tue 13:47]--[2025-11-11 Tue 13:49] =>  0:02
    CLOCK: [2025-11-10 Mon 10:17]--[2025-11-10 Mon 10:32] =>  0:15
    CLOCK: [2025-11-09 Sun 23:47]--[2025-11-10 Mon 00:27] =>  0:40
    CLOCK: [2025-11-09 Sun 23:24]--[2025-11-09 Sun 23:46] =>  0:22
    CLOCK: [2025-11-08 Sat 01:27]--[2025-11-08 Sat 01:36] =>  0:09
    CLOCK: [2025-11-07 Fri 10:35]--[2025-11-07 Fri 10:47] =>  0:12
    CLOCK: [2025-11-07 Fri 09:05]--[2025-11-07 Fri 09:13] =>  0:08
    CLOCK: [2025-11-07 Fri 08:50]--[2025-11-07 Fri 09:04] =>  0:14
    :END:

Updates to sprint and product backlog.

#+begin_src emacs-lisp :exports none
;; agenda
(org-agenda-file-to-front)
#+end_src

#+name: pie-stories-chart
#+begin_src R :var sprint_summary=sprint_summary :results file graphics :exports results :file sprint_backlog_04_stories_pie_sorted.png :width 1920 :height 1080
library(conflicted)
library(ggplot2)
library(tidyverse)
library(tibble)

# Remove unnecessary rows (Total time, Stories, Active)
clean_sprint_summary <- tail(sprint_summary, -4)
stories <- unlist(clean_sprint_summary[2])
percent_values <- as.numeric(unlist(clean_sprint_summary[6]))

# Create a data frame and explicitly sort the stories by defining factor levels
df <- data.frame(
  stories = stories,
  percent = percent_values
) %>%
  # 1. Sort the data frame by percentage in descending order
  arrange(desc(percent)) %>%
  # 2. Convert 'stories' to a factor, setting the levels based on the sorted order.
  # This makes the order of the slices explicit for ggplot.
  mutate(
    stories = factor(stories, levels = stories),
    lab.pos = cumsum(percent) - 0.5 * percent
  )

# Manually selected colors to resemble the screenshot
custom_palette <- c(
  "#21518f", "#f37735", "#ffc425", "#81b214", "#d7385e",
  "#662e91", "#00a9ae", "#5c5c5c", "#a0c6e0", "#f8b195",
  "#ffe385", "#bde0fe", "#c5e0d4", "#e0b8a0", "#a56f8f",
  "#7a448a", "#4a9a9b", "#9b9b9b", "#6fa8dc", "#f7a072",
  "#ffd166", "#99d98c", "#ef5d60", "#9d529f", "#3a86ff",
  "#c1d6e1", "#f9e0ac", "#c2d6a4", "#e69a8d", "#a07d9f"
)

# Ensure the palette has enough colors for all stories.
if (length(custom_palette) < length(df$stories)) {
  warning("Not enough custom colors for all stories. Colors will repeat.")
  custom_palette <- rep(custom_palette, length.out = length(df$stories))
}


p <- ggplot(df, aes(x = "", y = percent, fill = stories)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values = custom_palette) +
  ggtitle("Sprint 4: Resourcing per Story")  +
  labs(x = NULL, y = NULL, fill = "Stories") +
  theme_minimal() +
  theme(
    axis.text.x = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_text(hjust = 0.5, size = 18),
    legend.position = "right",
    legend.title = element_text(size = 14),
    legend.text = element_text(size = 12)
  )

print(p)
#+end_src

#+RESULTS: pie-stories-chart
[[file:sprint_backlog_04_stories_pie_sorted.png]]

#+name: stories-chart
#+begin_src R :var sprint_summary=sprint_summary :results file graphics :exports results :file sprint_backlog_04_stories.png :width 1200 :height 650
library(conflicted)
library(grid)
library(tidyverse)
library(tibble)

# Remove unnecessary rows.
clean_sprint_summary <- tail(sprint_summary, -4)
names <- unlist(clean_sprint_summary[2])
values <- as.numeric(unlist(clean_sprint_summary[6]))

# Create a data frame.
df <- data.frame(
  cost = values,
  stories = factor(names, levels = names[order(values, decreasing = FALSE)]),
  y = seq(length(names)) * 0.9
)

# Setup the colors
blue <- "#076fa2"

p <- ggplot(df) +
  aes(x = cost, y = stories) +
  geom_col(fill = blue, width = 0.6) +
  ggtitle("Sprint 4: Resourcing per Story") +
  xlab("Resourcing (%)") + ylab("Stories") +
  theme(text = element_text(size = 15))

print(p)
#+end_src

#+RESULTS: stories-chart
[[file:sprint_backlog_04_stories.png]]

#+name: tags-chart
#+begin_src R :var sprint_summary=sprint_summary :results file graphics :exports results :file sprint_backlog_04_tags.png :width 600 :height 400
library(conflicted)
library(grid)
library(tidyverse)
library(tibble)

# Remove unnecessary rows.
clean_sprint_summary <- tail(sprint_summary, -4)
names <- unlist(clean_sprint_summary[1])
values <- as.numeric(unlist(clean_sprint_summary[6]))

# Create a data frame.
df <- data.frame(
  cost = values,
  tags = names,
  y = seq(length(names)) * 0.9
)
# factor(names, levels = names[order(values, decreasing = FALSE)])

df2 <- setNames(aggregate(df$cost, by = list(df$tags), FUN = sum),  c("cost", "tags"))
# Setup the colors
blue <- "#076fa2"

p <- ggplot(df2) +
  aes(x = cost, y = tags) +
  geom_col(fill = blue, width = 0.6) +
  ggtitle("Sprint 4: Resourcing per Tag") +
  xlab("Resourcing (%)") + ylab("Story types") +
  theme(text = element_text(size = 15))

print(p)
#+end_src

#+RESULTS: tags-chart
[[file:sprint_backlog_04_tags.png]]

*** COMPLETED CTest shows only one test per test suite                 :code:

We need to be able to see individual tests and the reasons for their failures.

Notes:

- raised an issue with CMake.

Links:

- [[https://gitlab.kitware.com/cmake/cmake/-/issues/27363][#27363: CTest: Uploading generated JUnit XML from the test harness]]
- [[https://public.kitware.com/pipermail/cdash/2015-February/001544.html][[Cdash] How to send a JUnit result file to CDash server with CTest?]]

*** COMPLETED Clean up client parser                                   :code:
    :LOGBOOK:
    CLOCK: [2025-11-07 Fri 09:14]--[2025-11-07 Fri 09:24] =>  0:10
    :END:

It should use common infrastructure and read variables from the environment.

*** COMPLETED Add connect command line argument                        :code:
    :LOGBOOK:
    CLOCK: [2025-11-07 Fri 11:56]--[2025-11-07 Fri 13:15] =>  1:19
    :END:

To avoid leaking secrets it should be possible to supply a =--connect= in the
client. We still need a connect in case we want to reconnect.

Notes:

- clean up parser in client, not using common logging.
- add environment mapping to client.

Links:

- [[https://github.com/daniele77/cli/issues/250][#250: Basic Scripting with Cli]]

*** COMPLETED Install Windows package on Windows machine              :infra:
    :LOGBOOK:
    CLOCK: [2025-11-07 Fri 14:51]--[2025-11-07 Fri 16:28] =>  1:37
    CLOCK: [2025-11-07 Fri 11:33]--[2025-11-07 Fri 11:55] =>  0:22
    CLOCK: [2025-11-07 Fri 10:48]--[2025-11-07 Fri 10:58] =>  0:10
    :END:

We need to install and run the windows package and make sure it works. Check
console and GUI start. Also, check we can connect against local service and
against remove service.

Notes:

- application fails to start because QT6 DLLs are not in bin folder. It is also
  missing libssl. Adding vcpkg to presets copied a lot of the DLLs:

#+begin_src json
{
  "version": 3,
  "configurePresets": [
    {
      "name": "default",
      "generator": "Visual Studio 17 2022",
      "architecture": "x64",
      "toolchainFile": "$env{VCPKG_ROOT}/scripts/buildsystems/vcpkg.cmake",
      "binaryDir": "build",
      "cacheVariables": {
        "X_VCPKG_APPLOCAL_DEPS_INSTALL": true
      }
    }
  ]
}
#+end_src

- services are now running and connecting to postgres. Managed to connect from
  Linux to Windows and log in. However, Qt UI won't start due to missing DLLs.
  Installed Qt from online downloader, need to figure out what is missing. Open
  a separate story to handle Qt issues.

Links:

- [[https://github.com/microsoft/vcpkg/issues/43066][#43066: X_VCPKG_APPLOCAL_DEPS_INSTALL requires dumpbin to be on PATH for windows]]
- [[https://stackoverflow.com/questions/68579934/how-to-copy-targets-all-runtime-dependencies-after-build-process-in-cmake][How to copy target's all runtime dependencies after build process in CMake?]]
- [[https://stackoverflow.com/questions/78723493/cmake-install-rules][CMake install rules]]

*** BLOCKED Ignore warnings on windows and osx                         :code:
    :LOGBOOK:
    CLOCK: [2025-11-07 Fri 10:59]--[2025-11-07 Fri 11:32] =>  0:33
    :END:

At present we have a number of spurious warnings on both windows and OSX. Try to
see if we can get CDash to ignore them.

Notes:

- Raised a Kitware ticket.

Links:

- [[https://gitlab.kitware.com/cmake/cmake/-/issues/27367][CTest: Using regexes to filter warnings for CDash]]
- [[https://stackoverflow.com/questions/26458652/ctest-custom-warning-exception][SO: ctest custom warning exception]]

*** BLOCKED Ensure applications work under OSX using github images     :code:
    :LOGBOOK:
    CLOCK: [2025-11-07 Fri 16:29]--[2025-11-07 Fri 16:43] =>  0:14
    :END:

We need to install the DMG and run the app.

We think the package does not have all of the dependencies, but this did not
work:

#+begin_src cmake
if(APPLE)
    install(CODE "
        # make sure the bundle is already on disk
        set(BU_CHMOD_BUNDLE_ITEMS TRUE)
        include(BundleUtilities)

        # full path to the real executable inside the bundle
        set(app_exe \"\${CMAKE_INSTALL_PREFIX}/OreStudio.app/Contents/MacOS/OreStudio\")

        # directory where 3rd-party libraries will be copied
        set(libs_dir \"\${CMAKE_INSTALL_PREFIX}/OreStudio.app/Contents/Frameworks\")

        # discover all prerequisites and copy/fix them
        fixup_bundle(\"\${app_exe}\" \"\" \"\${libs_dir}\")
    " COMPONENT Runtime)
endif()
#+end_src

We should ask someone with an OSX machine to test this.

Links:

- [[https://stackoverflow.com/questions/17974439/cant-use-fixup-bundle-to-create-a-portable-bundle-with-qt][SO: Can't use fixup_bundle() to create a portable bundle with Qt]]

*** COMPLETED Create a splash screen and gray background              :infra:
    :LOGBOOK:
    CLOCK: [2025-11-07 Fri 23:30]--[2025-11-07 Fri 23:49] =>  0:19
    CLOCK: [2025-11-07 Fri 17:54]--[2025-11-07 Fri 18:57] =>  1:03
    CLOCK: [2025-11-07 Fri 16:49]--[2025-11-07 Fri 17:53] =>  1:04
    :END:

We need to replace the basic splash with something that looks slightly better.
We also need some kind of background for the initial screen when nothing is
selected, a bit like visual studio code.

*** COMPLETED Use fluent icons                                         :code:
    :LOGBOOK:
    CLOCK: [2025-11-07 Fri 23:50]--[2025-11-08 Sat 00:27] =>  0:37
    :END:

These seem to be a bit better than the current icons we have:

- [[https://github.com/microsoft/fluentui-system-icons/tree/main][fluentui-system-icons]]

*** COMPLETED Add export functionality for currencies                  :code:
    :LOGBOOK:
    CLOCK: [2025-11-08 Sat 22:34]--[2025-11-08 Sat 22:50] =>  0:16
    CLOCK: [2025-11-08 Sat 22:06]--[2025-11-08 Sat 22:33] =>  0:27
    CLOCK: [2025-11-08 Sat 21:59]--[2025-11-08 Sat 22:05] =>  0:06
    CLOCK: [2025-11-08 Sat 21:18]--[2025-11-08 Sat 21:59] =>  0:41
   :END:

We need to be able to export to ORE XML and to CSV.

*** COMPLETED Add currency editing support                             :code:
    :LOGBOOK:
    CLOCK: [2025-11-08 Sat 19:30]--[2025-11-08 Sat 21:17] =>  1:47
    CLOCK: [2025-11-08 Sat 00:28]--[2025-11-08 Sat 01:26] =>  0:58
    :END:

We need to be able to open up individual currencies and edit them. We also need
to be able to select multiple currencies and delete them.

Notes:

- add toolbar for crud operations. Not clear how we know what they apply to.
  Ideally you select multiple currencies and then press delete.
- separate the connection part of the toolbar from ref data and from crud.
- add a version string to the splash screen.

*** COMPLETED Add about to menu                                        :code:
    :LOGBOOK:
    CLOCK: [2025-11-09 Sun 00:47]--[2025-11-09 Sun 00:54] =>  0:07
    CLOCK: [2025-11-08 Sat 22:51]--[2025-11-08 Sat 23:46] =>  0:55
    :END:

We need an about describing the project.

*** COMPLETED Create a history dialog for currencies                   :code:
    :LOGBOOK:
    CLOCK: [2025-11-09 Sun 01:19]--[2025-11-09 Sun 02:21] =>  1:02
    CLOCK: [2025-11-09 Sun 00:54]--[2025-11-09 Sun 01:19] =>  0:25
    :END:

Users should be able to see a list of all the changes to a given currency.

Notes:

- valid to in edit dialog is still equal to valid from.
- create a history dialog showing the history of changes including modified by.

*** COMPLETED Currency details is always on top                        :code:

It should work like any other MDI window.

*** COMPLETED Do not auto maximise windows                             :code:

Every time we select currencies or history the new window is maximised. If there
is a previous window we should just reuse it. In addition if we ask for history
of the same currency twice, it should reuse the existing window.

*** COMPLETED Allow MDI windows outside main window                    :code:
    :LOGBOOK:
    CLOCK: [2025-11-09 Sun 10:20]--[2025-11-09 Sun 11:55] =>  1:35
    :END:

If possible we should allow windows to exist outside main window so users can
manage their workspace themselves.

Notes:

- currency details do not show up in window menu. Done
- currency detail is always detached. Done.
- windows are not sized correctly. Done.
- if a window is already open, we should reuse window. Done.

*** COMPLETED Add edit menu and export menu                            :code:
    :LOGBOOK:
    CLOCK: [2025-11-09 Sun 11:56]--[2025-11-09 Sun 12:30] =>  0:34
    :END:

Need a edit menu with all of the crud operations. At present these are only in
the toolbar. We also need one for export.

*** COMPLETED Implement adding new currencies                          :code:
    :LOGBOOK:
    CLOCK: [2025-11-09 Sun 18:01]--[2025-11-09 Sun 20:20] =>  2:19
    CLOCK: [2025-11-09 Sun 12:31]--[2025-11-09 Sun 13:29] =>  0:58
    :END:

At present you cannot add new currencies from the UI.

Notes:

- UI goes black if you close and reopen. Done.
- need a way to save the new currency to trigger sending message to server side.
- we should be able to send a message to create more than one currency in one
  go.
- it should be possible to clone a currency. It goes into new currency dialog
  with all fields filed in except for ISO code - maybe set to clone?
- add new message to repl.

*** COMPLETED Create an icon for the application                      :infra:

We copied the Dogen icon to get us going. We should really grab our own logo.

*** COMPLETED Add packaging support for images                        :infra:

*Rationale*: we are now packaging the images with the binary via Qt resources.

At present we are not adding images to packages.

*** COMPLETED Clean up product website                                 :code:
    :LOGBOOK:
    CLOCK: [2025-11-10 Mon 22:37]--[2025-11-10 Mon 23:42] =>  1:05
    CLOCK: [2025-11-10 Mon 22:30]--[2025-11-10 Mon 22:36] =>  0:06
    CLOCK: [2025-11-10 Mon 22:00]--[2025-11-10 Mon 22:29] =>  0:29
    CLOCK: [2025-11-10 Mon 17:33]--[2025-11-10 Mon 17:39] =>  0:06
    CLOCK: [2025-11-10 Mon 12:30]--[2025-11-10 Mon 15:26] =>  2:56
    :END:

As per weaving analysis we need to tidy-up our org-mode documents to build up
towards the setup needed for skills etc. Tidy up the product website, removing
things such as build instructions etc into it's own documents.

*** COMPLETED Create a skill for plant uml documentation               :code:
    :LOGBOOK:
    CLOCK: [2025-11-10 Mon 23:43]--[2025-11-11 Tue 02:31] =>  2:48
    :END:

Add a org mode document which generates a claude skill to document components in
plant uml format. Add a target to generate the skill.

*** COMPLETED Add CMake targets for site and skills                   :infra:
    :LOGBOOK:
    CLOCK: [2025-11-11 Tue 09:03]--[2025-11-11 Tue 09:20] =>  0:17
    :END:

Make it easier to run those targets from emacs.

*** COMPLETED Generalise the skill setup for ORE Studio               :infra:
    :LOGBOOK:
    CLOCK: [2025-11-11 Tue 13:04]--[2025-11-11 Tue 13:06] =>  0:02
    CLOCK: [2025-11-11 Tue 09:20]--[2025-11-11 Tue 13:03] =>  3:43
    :END:

It would be nice to be able to create skills quickly that model the common
activities we have. These roughly map to facets in MASD (Model Assisted Software
Development) world. We haven't got enough time to do a proper taxonomic and
morphological analysis of the system, but we can use the primitives defined in
MASD to guide skill creation (including meta-skill creation) and then create new
skills as we face new tasks. For now, setup a simple skill framework with a
meta-skill which makes skill management easier.

*** COMPLETED Restructure components to follow the dogen approach     :infra:
    :LOGBOOK:
    CLOCK: [2025-11-11 Tue 14:44]--[2025-11-11 Tue 17:38] =>  2:54
    :END:

We started by splitting tests from regular code. However, now we are introducing
models it is becoming very unwieldy. We need to follow the same structure as
dogen:

- =component=
  - =src=
  - =modeling=
  - =tests=

We do not need public/private includes for now so leave that under =src=.

Notes:

- create a skill describing expected project structure.
- update existing skills to take this change into account.

*** COMPLETED Generate PlantUML diagrams for all components           :infra:
    :LOGBOOK:
    CLOCK: [2025-11-11 Tue 17:39]--[2025-11-11 Tue 18:05] =>  0:26
    CLOCK: [2025-11-11 Tue 13:07]--[2025-11-11 Tue 13:46] =>  0:39
    :END:

We need an easy way to see the structure of the components. Use the new skill to
create diagrams.

*** COMPLETED Generate a pie chart for tasks in org via R              :code:

Ask the LLM on how to replicate the calc pie chart we previously had.

*** COMPLETED Weaving skills and documentation together            :analysis:
    :LOGBOOK:
    CLOCK: [2025-11-10 Mon 09:30]--[2025-11-10 Mon 10:16] =>  0:46
    :END:

Following on from the ideas on [[https://uhra.herts.ac.uk/id/eprint/17031/][Model Assisted Software Development]] (MASD), we
should weave together all of the project assets so that they simultaneously
generate:

- human level documentation, accessible via org-roam. This should also include
  diagrams to enable humans to understand the code structure.
- external documentation for website.
- LLM instructions, including skills.

Source code remains the only source of truth, but documentation is a projection
of the source code. The same documentation is simultaneously used by developers
and LLMs to understand the system.

Notes:

- generate a new =index.org= which is a more user friendly main page.
- split the existing =readme= into specialised pages which document aspects of
  the system such as building etc.
- create a =skills= folder under doc which are org mode documents that export
  into claude skills. Create CMake targets which generate the skills directory.
  Symlink it to the project directory =.claude/skills=.
- add a cmake target to generate the site. This should just generate HTML for
  the skills.
- add plantuml diagrams at the component level. These should leave under
  =modeling=.
- add plantuml diagram at the project level. Each component should have a link to
  the plantuml diagram of the component.
- teach claude how to generate a org-mode model of the component which documents
  each class. For comms, it should also generate an interaction diagram
  explaining how the client and server communicate.
- in the claude skills, explain that whenever adding domain entities, it needs
  to update
- perform a taxonomic analysis of how to break down existing code into skills.
  These will follow on from MASD's logical-physical space,
- it should also be possible to generate a PDF with all of the documentation,
  readable as a book.

*** COMPLETED Consider adding tags to catch2 tests                     :code:
    :LOGBOOK:
    CLOCK: [2025-11-14 Fri 20:21]--[2025-11-14 Fri 20:31] =>  0:10
    CLOCK: [2025-11-14 Fri 15:02]--[2025-11-14 Fri 15:26] =>  0:24
    :END:

It would be nice to run say repository tests when we do a DB change, or comms
tests etc. Catch supports tags for this. The problem is we need to manually add
CMake targets for each tag.

#+begin_src cmake
function(add_catch2_tag_target test_exe tag)
    string(REPLACE "[" "" clean_tag "${tag}")
    string(REPLACE "]" "" clean_tag "${clean_tag}")
    add_custom_target(test-${clean_tag}
        COMMAND ${test_exe} "${tag}"
        DEPENDS ${test_exe}
        WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
    )
    # Optional: register with CTest
    add_test(NAME ${test_exe}_${clean_tag} COMMAND ${test_exe} "${tag}")
endfunction()

# Usage:
add_catch2_tag_target(my_app_tests "[repository]")
add_catch2_tag_target(my_app_tests "[comms]")
#+end_src

*** STARTED Fix the valgrind leaks reported on sqlgen                  :code:
    :LOGBOOK:
    CLOCK: [2025-11-14 Fri 11:22]--[2025-11-14 Fri 11:25] =>  0:03
    CLOCK: [2025-11-14 Fri 11:06]--[2025-11-14 Fri 11:22] =>  0:16
    CLOCK: [2025-11-14 Fri 09:30]--[2025-11-14 Fri 11:05] =>  1:35
    CLOCK: [2025-11-13 Thu 08:20]--[2025-11-13 Thu 09:27] =>  1:07
    CLOCK: [2025-11-12 Wed 09:00]--[2025-11-12 Wed 10:53] =>  1:53
    :END:

We have a number of valgrind leaks which appear to be real leaks. Get to the
bottom of these and produce a fix.

Links:

- [[https://github.com/getml/sqlgen/issues/88][#88: Discussion on potential memory leaks in the postgres backend]]
- [[https://github.com/getml/sqlgen/pull/89][#89: Fix memory management for postgres in edge cases]]

*** STARTED Make UI/UX look more professional                          :code:
    :LOGBOOK:
    CLOCK: [2025-11-08 Sat 10:11]--[2025-11-08 Sat 20:04] =>  9:53
    CLOCK: [2025-11-08 Sat 08:57]--[2025-11-08 Sat 10:11] =>  1:14
    :END:

Analysis from Gemini:

#+begin_src markdown
To make your Qt application look like an advanced trading system—even for a
simple CRUD operation screen—requires moving beyond basic desktop application
styles toward the dense, high-contrast, data-rich aesthetic of platforms like
Bloomberg or professional broker terminals.

The current look (a dark table with simple data rows) is a great foundation.
Here are targeted suggestions for your Qt UI to elevate it to a professional,
advanced trading system aesthetic:

## I. Color and Contrast (The Dark Theme)

Your current dark gray background is good, but trading systems use specific
contrast to highlight data significance.

1.  **Define a Palette:** Adopt a limited, functional color palette:

      ,* **Primary Background:** A very dark, near-black charcoal (`#1A1A1A` or
        `#1E1E1E`). This is the foundation.
      ,* **Foreground/Text:** Clean white or light gray (`#F0F0F0`).
      ,* **Accent Color (Neutral):** A subdued corporate blue/cyan (`#007ACC` or
        a subtle green/gold from your branding) for selected rows, borders, and
        input focus.
      ,* **Data Status Colors:**
          ,* **Positive (Gains):** Bright, high-contrast green (`#00C853`).
          ,* **Negative (Losses):** High-contrast red (`#FF3333`).
          ,* *(While CRUD isn't about gains/losses, you can use these colors for
            status, like 'Active' vs. 'Inactive' currencies).*

2.  **Subtle Depth:** Avoid flat black. Use a slightly lighter shade of gray
    (`#2A2A2A`) for embedded panels, sidebars, and control areas to create
    visual segmentation, giving the impression of modularity.

## II. Typography and Data Presentation

Trading UIs prioritize density and scannability.

1.  **Monospace Font:** For the currency codes and numerical columns, switch to
    a clear, legible **monospace font** (like Consolas, Fira Code, or a custom
    font in Qt). Monospace fonts ensure that all numbers align perfectly in
    columns, which is essential for rapid data comparison.
2.  **Font Sizing:** Use a small, consistent font size (e.g., 10pt or 11pt) to
    fit more data on screen. Use bolding sparingly, primarily for the Currency
    Code (e.g., USD, EUR).
3.  **Visual Alignment:**
      ,* **Text Columns** (Currency Name): Left-aligned.
      ,* **Code Columns** (ISO Code, Symbol): Center-aligned.
      ,* **Numerical Columns** (Rounding, Precision): Right-aligned. **This is
        critical** for financial UIs, as it allows users to compare magnitude
        instantly.

## III. Advanced Table View Enhancements (QTableView/QTableWidget)

Since the core of this screen is a table, focus on making the table look
high-tech.

1.  **Header Styling:**

      ,* Make column headers slightly stand out with a subtle dark gradient or a
        distinct, slightly brighter background color (e.g., `#282828`).
      ,* Ensure the header font is crisp (perhaps slightly bolder than the row
        data).
      ,* Add tiny, clear **sort indicators** to show the current sort direction.

2.  **Row Selection:**

      ,* The selected row should use your accent color (e.g., a thin blue left
        border or a light blue background fill) with white or light gray text
        for high visibility.
      ,* Introduce **subtle, faint horizontal rules** (1px in a color like
        `#333333`) to separate rows, which aids readability in dense tables.

3.  **Interactive Elements (Hover):** Implement a very subtle change on row
    hover (e.g., the background darkens by 5%) to indicate interactivity, even
    if clicking doesn't change the view.

## IV. UI Layout and Modularity

Advanced UIs are rarely monolithic; they are built from modular panels.

1.  **Toolbar (Top):** Create a clean, dedicated toolbar area at the top for
    your CRUD operations (`Add`, `Edit`, `Delete`) and your system icons
    (Connection, Reference Data).

      ,* Use the Fluent UI System Icons you researched (`globe-32-regular`,
        `money-32-regular`).
      ,* Buttons should be flat, high-contrast text or icons only. On hover, they
        should reveal a subtle gray background or a thin accent border.

2.  **Side Panel (Right or Left):** Instead of a simple dialog for *editing*,
    use a dedicated side panel that slides out or appears next to the table when
    a row is selected.

      ,* This panel would house the detail view for the selected currency. This
        makes the UI feel like a single workspace rather than navigating modal
        windows.
      ,* Give this panel a slightly different background shade (`#2A2A2A`).

3.  **Status Bar (Bottom):** Add a sleek, minimal status bar at the bottom. This
    is where you would place your connection status icon (using your proposed
    `globe-32-regular` or `plug-connected-32-regular` icon). It reinforces the
    "system is live" feel.

## V. Qt-Specific Implementation via Stylesheets

In Qt, you achieve this professional look primarily through **QSS (Qt Style
Sheets)**. You will be targeting specific widgets (like `QTableView`,
`QPushButton`, `QLineEdit`) with CSS-like rules.

```css
/* Example QSS Snippets for the Trading Look */

QTableView {
    /* Base style for the data area */
    background-color: #1A1A1A; /* Primary Background */
    gridline-color: #333333; /* Faint row separators */
    color: #F0F0F0;
    border: 1px solid #007ACC; /* Subtle border using accent color */
    selection-background-color: #007ACC; /* Accent Color for selection */
    selection-color: white;
}

QHeaderView::section {
    /* Style for Column Headers */
    background-color: #282828; /* Slightly lighter shade for headers */
    color: #FFFFFF;
    border: none;
    padding: 6px;
    font-size: 11pt;
    font-weight: bold;
}

QLineEdit {
    /* Style for input fields (e.g., in the side panel or search) */
    background-color: #1A1A1A;
    border: 1px solid #444444;
    color: #F0F0F0;
    padding: 5px;
}

QPushButton {
    /* Flat button style for toolbar */
    background-color: transparent;
    border: none;
    color: #F0F0F0;
    padding: 8px 12px;
}

QPushButton:hover {
    /* Hover effect */
    background-color: #2A2A2A;
    border: 1px solid #007ACC;
}
```
#+end_src

*** STARTED Current issues with package install in debian              :code:
    :LOGBOOK:
    CLOCK: [2025-11-09 Sun 09:02]--[2025-11-09 Sun 09:28] =>  0:26
    :END:

At present we have several issues with packaging:

- debs are built on ubuntu so they cannot install on latest debian testing as
  the t64 migration has been completed. Error:

#+begin_src sh
root@lovelace:~# apt install /home/marco/Downloads/orestudio_0.0.4_amd64.deb
You might want to run 'apt --fix-broken install' to correct these.
Unsatisfied dependencies:
 orestudio : Depends: libqt6gui6t64 (>= 6.1.2) but it is not installable
             Depends: libqt6widgets6t64 (>= 6.1.2) but it is not installable
Error: Unmet dependencies. Try 'apt --fix-broken install' with no packages (or specify a solution).
root@lovelace:~# apt install libqt6widgets6t64 libqt6gui6t64
Package libqt6gui6t64 is not available, but is referred to by another package.
This may mean that the package is missing, has been obsoleted, or
is only available from another source
However the following packages replace it:
  libqt6gui6:i386  libqt6gui6


Package libqt6widgets6t64 is not available, but is referred to by another package.
This may mean that the package is missing, has been obsoleted, or
is only available from another source
However the following packages replace it:
  libqt6widgets6:i386  libqt6widgets6


Error: Package 'libqt6widgets6t64' has no installation candidate
Error: Package 'libqt6gui6t64' has no installation candidate
#+end_src

- assets are not being packaged:

#+begin_src sh
[marco@lovelace bin]$ ./ores.qt
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_currency_dollar_euro_20_filled.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_history_20_regular.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_plug_disconnected_20_filled.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_plug_connected_20_filled.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_edit_20_filled.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_delete_20_filled.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_save_20_filled.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_document_table_20_regular.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_document_code_16_regular.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_star_20_regular.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_plug_connected_20_filled.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_plug_disconnected_20_filled.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_plug_connected_20_filled.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_plug_disconnected_20_filled.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_currency_dollar_euro_20_filled.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_save_20_filled.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_edit_20_filled.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_delete_20_filled.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_document_table_20_regular.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_document_code_16_regular.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_star_20_regular.svg', because: No such file or directory
qt.svg: Cannot open file '/opt/OreStudio/0.0.4/bin/ic_fluent_history_20_regular.svg', because: No such file or directory
#+end_src

- when starting the package from a directory, it tries to create the log
  relative to that directory:

#+begin_src sh
[marco@lovelace ~]$ /opt/OreStudio/0.0.4/bin/ores.qt
terminate called after throwing an instance of 'boost::filesystem::filesystem_error'
  what():  boost::filesystem::create_directories: Permission denied [system:13]: "/home/marco/../log", "/home/marco/../log"
Aborted                    /opt/OreStudio/0.0.4/bin/ores.qt
#+end_src


    :LOGBOOK:
    CLOCK: [2025-11-09 Sun 21:00]--[2025-11-09 Sun 21:14] =>  0:14
    :END:

When investigating a crash we noticed the app is not exiting cleanly. Fix all of
these crashes before we go any further.

*** STARTED Resolve crash on shutdown problem                          :code:
    :LOGBOOK:
    CLOCK: [2025-11-09 Sun 21:21]--[2025-11-09 Sun 22:11] =>  0:50
    :END:

At present the app crashes when shutting down. This is due to the attach /
detach logic. We need to workout a plan for managing this. K2:

#+begin_src markdown
Yes — but only if you **keep the same ownership rule in both states** (attached *and* detached).
The moment you let Qt parent the widget **and** still keep it in a container that you later `delete`, you again have **two owners**, and the double-delete will come back as soon as the user re-attaches the window and then quits the program.

Below is the minimal change that lets the user detach/reattach as often as he wants **and** guarantees that the object is destroyed **exactly once**.

--------------------------------------------------------
1.  Pick one unique owner
--------------------------------------------------------
Make **MainWindow** the unique owner.
That means:

- Never give the widget a parent (pass `nullptr` in the constructor).
- Always insert it into one of the four containers.
- Delete it **only** from those containers (or when the user explicitly closes
  it).
- When the widget is *attached* to the MDI area, use
  ,**QMdiArea::addSubWindow()**; this only sets the **QMdiSubWindow** as parent
  of the **internal viewport**, **not** of your custom widget, so your widget
  stays parent-less.

Code sketch:

```cpp
// create
auto w = new CurrencyMdiWindow(nullptr);          // no parent
mdiArea->addSubWindow(w);                         // only the QMdiSubWindow gets a parent
currencyDetailWindows_.insert(iso, w);
allDetachableWindows_.append(w);
```

--------------------------------------------------------
2.  Remove it from the lists at the right moment
--------------------------------------------------------
As soon as the widget dies (user presses ×, or you programmatically close it) you must **erase the pointer** from every container; otherwise you will dereference a dangling pointer when you later iterate over the lists.

Connect once, right after creation:

```cpp
connect(w, &QObject::destroyed, this, [this, w](QObject* o) {
    Q_UNUSED(o)
    currencyDetailWindows_.remove(w->isoCode());
    allDetachableWindows_.removeAll(w);
    /* same for the other three maps/lists */
});
```

--------------------------------------------------------
3.  Detach / re-attach implementation
--------------------------------------------------------
Detaching simply reparents to **nullptr** and shows the widget as top-level:

```cpp
void MainWindow::detachWindow(QWidget* w)
{
    w->setParent(nullptr);
    w->show();
}
```

Re-attaching puts it back into the MDI area:

```cpp
void MainWindow::attachWindow(QWidget* w)
{
    w->setParent(nullptr);              // make sure it is still parent-less
    mdiArea->addSubWindow(w);
    w->show();
}
```

Because the widget **never** had a Qt parent, Qt will **never** auto-delete it; only your own code (or the user closing the top-level window while `Qt::WA_DeleteOnClose` is set) can trigger the `destroyed()` signal, and that signal already removed the pointer from the lists.

--------------------------------------------------------
4.  Destructor becomes trivial
--------------------------------------------------------
```cpp
MainWindow::~MainWindow()
{
    // delete every widget that is still alive
    qDeleteAll(currencyDetailWindows_);
    qDeleteAll(currencyHistoryWindows_);
    delete currencyListWindow_;
    qDeleteAll(allDetachableWindows_);
}
```

Each widget is deleted **once**, the `destroyed()` lambda runs immediately and clears the lists, so when the next container is destroyed its `qDeleteAll` sees only `nullptr`s (or the map is already empty).

--------------------------------------------------------
5.  Optional extra safety
--------------------------------------------------------
If you want to be 100 % sure, store **QPointer** in the containers instead of raw pointers:

```cpp
QMap<QString, QPointer<DetachableMdiSubWindow>> currencyDetailWindows_;
```

Now the destructor can even be written as

```cpp
for (auto it = currencyDetailWindows_.begin(); it != currencyDetailWindows_.end(); ++it)
    delete it.value();   // safe: delete nullptr is a no-op
```

but this is **not required**—the design above is already bullet-proof.

--------------------------------------------------------
Summary
--------------------------------------------------------
- Pick **one** owner (MainWindow).
- Keep widgets **parent-less**.
- Add / remove them from the lists **synchronously** via `destroyed()`.
- Detach/reattach only changes **visual** parent, not ownership.

With these rules you can detach and re-attach as often as you like, and the
program will still shut down without the heap corruption you are seeing now.
#+end_src

*** STARTED Review all code created so far with an LLM                 :code:
    :LOGBOOK:
    CLOCK: [2025-11-14 Fri 11:52]--[2025-11-14 Fri 11:58] =>  0:06
    CLOCK: [2025-11-13 Thu 22:17]--[2025-11-13 Thu 23:33] =>  1:16
    CLOCK: [2025-11-13 Thu 18:20]--[2025-11-13 Thu 20:13] =>  1:53
    CLOCK: [2025-11-13 Thu 16:45]--[2025-11-13 Thu 17:40] =>  0:55
    CLOCK: [2025-11-13 Thu 09:34]--[2025-11-13 Thu 11:01] =>  1:27
    CLOCK: [2025-11-12 Wed 21:18]--[2025-11-13 Thu 00:01] =>  2:43
    CLOCK: [2025-11-12 Wed 14:44]--[2025-11-12 Wed 15:32] =>  0:48
    CLOCK: [2025-11-12 Wed 12:10]--[2025-11-12 Wed 12:50] =>  0:40
    :END:

Current code review prompt:

#+begin_quote
Perform a fast, focused code review on the code I’ll show you.

Look for:

- Obvious bugs or logic errors
- Missed opportunities to use C++23 features
- Incorrect or unclear comments (improve them if needed)
- Security issues or unsafe patterns
- Inappropriate or missing logging (check log level and message clarity)
- Any other clear improvements worth noting
- For unit tests, ensure they are named correctly and have enough coverage

Be succinct — prefer clarity over grammar.

Output a short list of actionable items, ideally with suggested fixes.

The system uses Data-Oriented design for finance.

I’ll show you the header and implementation (if any) separately — comment on
them separately.
#+end_quote

- reviewing =ores.accounts=. Done core library, missing tests.
- reviewing =ores.cli=.

Notes:

- account unlock should return boolean rather than throw.

*** Invalid password should not throw                                  :code:

At present in the unlock test we have:

#+begin_src c++
    BOOST_LOG_SEV(lg, info) << "Locking account by failing 5 login attempts";
    auto ip = internet::ipv4();
    for (int i = 0; i < 5; ++i) {
        try {
            sut.login(account.username, "wrong_password", ip);
        } catch (...) {}
    }
#+end_src

This is very suspicious; a failed login should just return false or the modern
c++ equivalent (=std::expected=?).

*** Faker with seeds                                                   :code:

As suggested by phi4:

#+begin_quote
Faker Usage:

Randomness: Ensure that the use of faker data is appropriate for testing.
Consider seeding the random generator for reproducibility in tests.
#+end_quote

Notes:

#include "faker-cxx/generator.h"
void setSeed(std::mt19937_64::result_type seed)
Catch::rngSeed()


*** Implement delete account                                           :code:

At present you cannot delete an account.

*** Add =[[nodiscard]]= to repository operations returning data        :code:

At present we can create an account and ignore the result, etc. We should be
forced to look at the result.

*** Add lock account request                                           :code:

As per gemini's comments, we should have a request to lock an account.

Test.

#+begin_src c++
TEST_CASE("handle_login_request_locked_account", tags) {
    auto lg(make_logger(test_suite));
    database_helper h;
    h.truncate_table(database_table);

    accounts_message_handler handler(h.get_context());
    boost::asio::io_context io_context;

    const auto account = generate_synthetic_account();
    create_account_request create_req(to_create_account_request(account));
    BOOST_LOG_SEV(lg, info) << "Create account request: " << create_req;

    const auto create_payload = create_req.serialize();
    run_co_test(io_context, [&]() -> boost::asio::awaitable<void> {
        auto result = co_await handler.handle_message(
            message_type::create_account_request,
            create_payload, "127.0.0.1:12345");
        REQUIRE(result.has_value());
    });

    // 2. Simulate locking the account (A dedicated lock request should exist,
    //    but for this test, we'll assume the handler has a method/logic for it
    //    or that the system supports a lock request message type).
    // Assuming a lock_account_request exists or the account is locked internally.
    unlock_account_request lock_req; // Re-use struct for simplicity, assuming a dedicated lock is handled internally
    lock_req.account_id = create_account_response::deserialize(
        handler.get_account_id_by_username(create_req.username)).value().account_id; // Hypothetical internal method
    // In a real system, you'd send a dedicated lock message here.
    // For now, we rely on a separate mechanism to put the account into a locked state.
    // **NOTE**: For a proper test, a dedicated LOCK_ACCOUNT_REQUEST is needed.

    // 3. Attempt login with valid credentials for the now-locked account
    login_request login_req;
    login_req.username = create_req.username;
    login_req.password = create_req.password;
    BOOST_LOG_SEV(lg, info) << "Attempting login for locked user: " << login_req.username;

    const auto login_payload = login_req.serialize();

    run_co_test(io_context, [&]() -> boost::asio::awaitable<void> {
        auto result = co_await handler.handle_message(
            message_type::login_request,
            login_payload, "192.168.1.100:54321");

        REQUIRE(result.has_value());
        const auto response_result = login_response::deserialize(result.value());
        REQUIRE(response_result.has_value());
        const auto& response = response_result.value();
        BOOST_LOG_SEV(lg, info) << "Response: " << response;

        CHECK(response.success == false);
        // Check for an explicit error message/code related to account lock.
        CHECK(response.error_message.find("locked") != std::string::npos);
    });
}
#+end_src



*** Add pagination support                                             :code:

At present we are returning all elements from accounts, currencies etc. We need
to implement pagination:

- Add offset and limit to list_accounts_request.
- Add total_available_count to list_accounts_response.

#+begin_src c++
std::vector<domain::account>
account_repository::read_latest(std::uint32_t offset, std::uint32_t limit) {
    BOOST_LOG_SEV(lg(), debug) << "Reading latest accounts with offset: "
                               << offset << " and limit: " << limit;

    static auto max(make_timestamp(max_timestamp));
    const auto query = sqlgen::read<std::vector<account_entity>> |
        where("valid_to"_c == max.value()) |
        order_by("valid_from"_c.desc()) |
        sqlgen::limit(limit) |
        sqlgen::offset(offset);

    const auto r = session(ctx_.connection_pool())
        .and_then(query);
    ensure_success(r);
    BOOST_LOG_SEV(lg(), debug) << "Read latest accounts. Total: " << r->size();
    return account_mapper::map(*r);
}


std::uint32_t account_repository::get_total_account_count() {
    BOOST_LOG_SEV(lg(), debug) << "Retrieving total active account count.";

    static auto max(make_timestamp(max_timestamp));

    // Select the count of records that are currently active (valid_to == max_timestamp)
    // We expect the result to be a vector containing a single long long (the count).
    using count_result_type = std::vector<long long>;
    const auto query = sqlgen::select<count_result_type>(sqlgen::count("id"_c)) |
        from<account_entity> |
        where("valid_to"_c == max.value());

    const auto r = session(ctx_.connection_pool())
        .and_then(query);
    ensure_success(r);

    if (r->empty() || r->at(0) < 0) {
        return 0;
    }

    const auto total_count = static_cast<std::uint32_t>(r->at(0));

    BOOST_LOG_SEV(lg(), debug) << "Total active accounts found: " << total_count;
    return total_count;
}
#+end_src


Links:

- [[https://readyset.io/blog/optimizing-sql-pagination-in-postgres][Optimizing SQL Pagination in Postgres]]

*** Do not return sensitive fields                                     :code:

As per code review:

#+begin_quote
Major Security Flaw (list_accounts_response): The serialization format
explicitly includes highly sensitive fields (password_hash, password_salt,
totp_secret) for every domain::account returned. This is a severe security risk.
These fields must not be exposed over any messaging protocol, even internal
ones, unless it is a dedicated, highly protected replication channel.

Proposed Change: Create a protocol-safe subset structure, e.g.,
domain::account_summary, which contains only non-sensitive data (id, username,
email, is_admin, version, modified_by). Update list_accounts_response to use
std::vector<domain::account_summary>.

Change list_accounts_response::accounts to use a non-sensitive type like
std::vector<domain::account_summary>.
#+end_quote
*** Improve error message when server is not running                   :code:

At present we get:

#+begin_quote
Failed to connect to server: Failed to connect to server
#+end_quote

If we try again after the error, "authenticating..." shows up in red.

*** Add a "detached" mode                                             :code:

At present we can detach all windows but if we then create a new one, we still
have to detach it. It would be nice to set the default to detach or not, and
then use that setting.

*** Move =base32_encode= to utilities                                  :code:

Add tests. Also move =host_to_network_32=, =read_uint16=, etc.

*** Create a claude code skill to open a new sprint                    :code:

Needs to update all of the version strings, copy backlog etc.

*** When you maximise currencies merge toolbars                        :code:

At present we end up with two tool bars, one below the other.

*** Add a version attribute to entities                                :code:

At present we are relying only on bitemporal for version control. However it is
much easier to check a version number. It should just be a linear attribute
which is updated whenever we insert into the entity table. If the user attempts
to update an entity but the current version is smaller than the latest version
we should error. Make version unique.

*** Merge update and create currency messages                          :code:

Due to how repositories work for bitemporal, we are always writing anyways. So
we don't really need complex logic around updating versus creating a new
currency. We need to simplify the UI and client / server code to have a single
message type for both.

*** Implement import XML                                               :code:

Users should be able to import data from ORE directly.

*** Update currency details to use tabs                                :code:

We need a main tab with the currency related properties, then a "system" tab
with temporal data which is read-only even on edit and a "image" tab with the
image used to represent the currency. It could also contain some description or
notes.

*** Add a delete all button which deletes all currencies               :code:

It is useful especially in test environments to be able to delete all entities
before a re-import.

*** History should have a revert button                                :code:

It should be possible to choose a given version and ask the system to revert the
currency to that version. It just makes an update with a new version to look
like that version. It should also be possible to open at version. It shows the
edit dialog in "read only mode" with the entity at that version. The tool bar
should indicate this. It should also have a revert in that dialog.

*** Assorted UI polish work                                            :code:

Break these down into their own stories:

- icons for CRUD are not enabling when on detached mode.
- no status bar in dettached mode.
- should we just have toolbars at the detached window level?
- application should exit when main window is closed.
- is it possible to dock windows like visual studio?
- add a detach current window that just detaches that window.
- disabled menu options are not properly greyed out. Done.

*** Add multi-selection support to currencies                          :code:

Users should be able to select multiple currencies and delete them. Maybe we
should do like gmail and have check boxes?

*** Allow in place editing of currencies                               :code:

For expediency users should be able to edit multiple currencies and save them in
one go directly in the grid. Shift enter to edit a field seems interesting.

Users need to be made aware when there are changes in CRUD objects, and there
needs to be a reload button to reload data from the database in that case. This
could be done by making the reload button a different colour when data is
available.

Make the reload button blue when there are changes.

Notes:

- history windows should also have the notification.

*** Notification of server restarts                                    :code:

Whenever we lose connection to the server the UI needs to tell the user and
change to disconnected.

*** Add search to currencies                                           :code:

It should be possible to filter the open currencies by a string. This should be
any field. The user needs to know when the list has been filtered.

*** Add a generic tagging system                                       :code:

It should be possible to associate any entity with one or more tags and then do
a search by tags on that entity type. For example, tag a set of currencies as
emerging markets and then search by that.

Labels versus tags:

#+begin_src markdown
That is an **excellent question** that gets to the heart of cloud governance and
system design. You are correct that the underlying structure is fundamentally
the same—a **key-value pair attached to a resource**—but the distinction is
necessary because of the **context, governance, and enforcement mechanisms**
applied to each one.

The distinction between GCP Labels and Tags boils down to **Annotation vs.
Policy**.

---

## ⚖️ Why the Distinction is Necessary

| Feature              | GCP **Labels** (Annotation)                                                                          | GCP **Tags** (Policy/Governance)                                                                                                                                               |
|:---------------------|:-----------------------------------------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Primary Goal**     | **Organization, filtering, cost allocation, and reporting.**                                         | **Policy enforcement, access control, and hierarchical governance.**                                                                                                           |
| **Structure**        | **Flexible/Arbitrary.** Key-Value pair set directly on the resource.                                 | **Structured/Centralized.** Key and Value are defined *centrally* as separate resources (at the Organization/Project level) and then *bound* to the resource.                  |
| **Hierarchy**        | **Flat.** A resource does not inherit labels from its parent folder.                                 | **Hierarchical.** Tags are inherited by child resources (like a VM inheriting a tag from its containing project).                                                              |
| **Access Control**   | **Low Control.** Any user with permissions to modify the resource can typically modify its labels.   | **High Control.** Dedicated **IAM Roles** are required to create, manage, and even attach Tag Keys and Values. This prevents users from "tagging" their way out of a policy.   |
| **Enforcement**      | **None.** Labels are metadata and cannot be used directly in IAM conditions to grant or deny access. | **High.** Tags are the *only* mechanism designed for **conditional IAM policies** and Organization Policies (e.g., "deny deletion unless resource has tag `environment:dev`"). |
| **Use Case Example** | Filtering the console: "Show me all resources labeled `owner:john_doe`."                             | Security: "Only allow network traffic from resources tagged `security_zone:trusted`."                                                                                          |

### Analogy: The Whiteboard vs. The Building Code

1.  **Labels are like a sticky note on a whiteboard:**
    ,* They are **flexible**, quickly written, and easy to change.
    ,* They are used for **informal organization** (cost center, app name, etc.).
    ,* Changing the note has **no impact on the resource's function** or security.

2.  **Tags are like a building code requirement:**
    ,* They are **highly structured** and defined by a central authority (the city/organization).
    ,* They are used to **enforce policy** (safety, compliance).
    ,* If a resource (a building) doesn't have the correct tag (e.g., a **fire-rating tag**), an automated system (the policy engine) will **deny an action** (e.g., deny occupation or modification).

---

## How This Relates to Your SVG System

Your current **three-table model** is structurally a **GCP Label** system—it's
excellent for annotation and filtering (e.g., "Give me all icons with the tag
'currency'").

If you wanted to implement a **GCP Tag** concept, you would need to:

1.  **Formalize the Tags:** Create certain tags as *official resources* (like
    `Status` with official values `Draft`, `Approved`, `Production`).
2.  **Add Permissions:** Implement **application logic** that checks a user's
    role against the tag. For example: "A user needs the `Approver` role to
    apply the `Status:Production` tag to an icon."

The need to distinguish them comes down to providing one system that is
,**flexible for organization (Labels)** and another that is **rigid for security
and compliance (Tags)**.
#+end_src

Examples:

- majors, minors, EM, latam, etc are tags we can have on currencies. On currency
  pairs, We could also have USD crosses, which is inferred by having USD as one
  of the pair. However these are not labels because we do not want everyone to
  start using them. When defining a report, you could associate currencies and
  currency pairs to the report via the tags.
- labels are things we could associate with images for example. Flags could have
  both "countries" and "currencies" labels so that when we want to select a flag
  as the image for a currency, we could ask for all images labelled
  "currencies". The labelling can be done by pretty much anyone.

*** Add flags for currencies                                           :code:

Add flags for the currencies. Need database support. Display them in the
currencies dialog.

Actually it is better to have a generic mechanism to upload an SVG and maybe tag
it with an identifier. Then we could have a way to associate a currency with one
of the available SVGs. The currency dialog could have a tab where users can
select the SVG from a list. We can then have a table with SVG for currency which
remembers these. This provides a generic solution for all cases where we have
some kind of asset and an associated image.

SQL:

#+begin_src sql
-- Ensure you have the necessary extension for generating random UUIDs
CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- 1. icons table: Stores the SVG data
CREATE TABLE icons (
    -- Primary key using UUID (GUID)
    icon_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

    -- Unique key used by the application (e.g., 'usd_flag', 'btc_symbol')
    key VARCHAR(100) UNIQUE NOT NULL,

    -- The entire SVG content stored as plain text
    svg_data TEXT NOT NULL,

    -- Optional timestamps
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- Index the 'key' column for faster lookups
CREATE INDEX idx_icons_key ON icons (key);

---

-- 2. tags table: Stores the list of available categories
CREATE TABLE tags (
    -- Primary key remains SERIAL as tags are usually created centrally
    tag_id SERIAL PRIMARY KEY,

    -- The name of the tag (e.g., 'currency', 'flag', 'commodity')
    name VARCHAR(50) UNIQUE NOT NULL
);

-- Index the 'name' column for quick lookups and joins
CREATE INDEX idx_tags_name ON tags (name);

---

-- 3. icon_tags table: Junction table for the many-to-many relationship
CREATE TABLE icon_tags (
    -- Foreign key to the icons table (now a UUID)
    icon_id UUID NOT NULL REFERENCES icons(icon_id) ON DELETE CASCADE,

    -- Foreign key to the tags table (remains INTEGER)
    tag_id INTEGER NOT NULL REFERENCES tags(tag_id) ON DELETE CASCADE,

    -- Ensures that each icon/tag combination can only exist once
    PRIMARY KEY (icon_id, tag_id)
);

-- Optional: Create a separate index for lookups by tag
CREATE INDEX idx_icon_tags_tag_id ON icon_tags (tag_id);
#+end_src


*** Light system theme results in mix of dark and light                :code:

We need to ensure we can have both light and dark themes and they work
consistently.

*** Update readme with UI screenshots                                  :code:

Now that we have a basic UI up and running, add it to docs.

*** Repl needs synchronous socket operations                           :code:

At present the operations on sockets are async. This is a problem with the repl
because we issue commands out of order. For example this causes scripting to
fail.

- [[https://github.com/daniele77/cli/discussions/251][#251: Basic Scripting with Cli]]

*** Setup Qt properly on Windows                                       :code:

Seems like our package is still missing Qt DLLs. Use the windows tool to
determine what is missing. Consider installing Qt in the build machine via the
built packages.

*** Server must check database connectivity on startup                 :code:

At present the server only checks connectivity to database when a user requests
an operation. We need some kind of initial polling which puts the server in a
mode replying to all clients: "database not available". While this is happening,
it should keep polling the database and checking the connectivity.

*** Add SC script on windows to install ores.service                   :code:

We should package a trivial batch file that sets up the service on windows. We
should also consider adding a simple script to setup the service on Linux.
Ideally it should be done via the packaging step.

*** Package SQL scripts                                                :code:

We need to initialise the database on installation. The package should contain
all of the necessary SQL as well as a script to do it.

*** Resolve all of the OpenSSL leaks in valgrind                       :code:

We are freeing up open SSL memory and still have leaks. For now just apply the
suppression suggestions and deal with this later.

*** Add support for feature flags                                      :code:

We need a way to know if we are in bootstrap mode or not. Implement a generic
mechanism for feature flags.

Example chrome flag:

#+begin_quote
Temporarily unexpire M139 flags.

Temporarily unexpire flags that expired as of M139. These flags will be removed
soon. – Mac, Windows, Linux, ChromeOS, Android

#temporary-unexpire-flags-m139
#+end_quote

Components:

- name: human readable
- description
- id

*** Implement authentication bootstrap workflow                        :code:

Notes:

- when there are no accounts setup, the repl should say to the user that it
  needs to create an admin account.
- first account must be admin.
- once there is an account we need to make sure the user is logged in before we
  process most message types.

Mongo message:

#+begin_src logview
2020-06-09T13:26:51.391+0000 I  CONTROL  [initandlisten] ** WARNING: Access control is not enabled for the database.
2020-06-09T13:26:51.391+0000 I  CONTROL  [initandlisten] **          Read and write access to data and configuration is unrestricted.
#+end_src

Requirements:

#+begin_src markdown
# Authentication Bootstrapping Requirements

## R1: Initial System State (Bootstrap Mode)

The system **MUST** start in a special **"Bootstrap Mode"** where the only
permitted action is the creation of the initial Administrator account.

## R2: Access Control in Bootstrap Mode

While the system is in Bootstrap Mode:

- **R2.1: Allowed Endpoint:** The service **MUST** only expose and accept
  requests for a single endpoint: `POST /api/v1/accounts/create-admin` (or
  equivalent).
- **R2.2: Local-Only Restriction:** All requests to the allowed endpoint
  ,**MUST** originate from a **trusted local interface** (e.g., `127.0.0.1` or
  the server's designated internal IP range). Requests from any external/public
  IP address **MUST** be rejected.
- **R2.3: General Endpoint Rejection:** All other API endpoints (e.g., login,
  user creation, data access) **MUST** immediately return a $\mathbf{403}$
  ,**Forbidden** or $\mathbf{401}$ **Unauthorized** status, along with a clear
  message indicating the system is in setup mode.

## R3: Initial Admin Account Creation

The first account created through the allowed endpoint **MUST** adhere to the
following:

- **R3.1: Mandatory Admin Role:** The account **MUST** be assigned the highest
  level of **Administrator privileges** (`is_admin: true`).
- **R3.2: Strong Password Policy:** The request **MUST** be validated against a
  strong password policy (e.g., minimum 12 characters, requiring a mix of case,
  numbers, and symbols). Failure to meet this standard **MUST** result in a
  $\mathbf{400}$ **Bad Request** error.
- **R3.3: One-Time Execution:** The administrator creation process **MUST** only
  be allowed to succeed **exactly once**.

## R4: System State Transition

Upon successful creation of the first Administrator account (R3):

- **R4.1: State Change:** The system **MUST** immediately and atomically
  transition from **"Bootstrap Mode"** to **"Secure Mode"**. This state change
  ,**MUST** be persisted.
- **R4.2: Bootstrap Endpoint Deactivation:** The `POST
  /api/v1/accounts/create-admin` endpoint **MUST** be permanently disabled. Any
  subsequent request to this endpoint **MUST** return a $\mathbf{403}$
  ,**Forbidden** error.

## R5: Secure Mode Operation

Once the system is in **"Secure Mode"**:

- **R5.1: General Access Control:** All operational API endpoints **MUST** now
  enforce **full authentication and authorization**.
- **R5.2: Mandatory Login:** All users, including the newly created
  Administrator, **MUST** successfully complete a login process to obtain a
  valid session token before accessing any resource.
- **R5.3: Standard Account Creation:** The standard non-admin account creation
  endpoint (`POST /api/v1/accounts/create`) **MUST** become available, subject
  to any configured access controls (e.g., only open to logged-in Admins, or
  fully public).
#+end_src

Links:

- [[https://www.digitalocean.com/community/tutorials/how-to-secure-mongodb-on-ubuntu-20-04][How To Secure MongoDB on Ubuntu 20.04]]

*** Remove postgres passwords from github workflows                    :code:

As a quick hack we added the dev passwords to the workflows. We should really
generate these on the fly and supply them to the tests.

*** Allow supplying the postgres connection URI                        :code:

At present we are supplying all of the components for the connection. It may be
easier to allow the entire URI:

- connection-uri: The connection URI to connect to PostgreSQL. Example:
  =postgresql://postgres:postgres@localhost/postgres=.

*** Consider adding log command line options to qt                     :code:

At present we have hard-coded logging options. However, maybe users should be
able to change the logging settings from the UI rather than having to restart
the app and supply command line options.

*** Investigate valgrind leak on sqlgen                                :code:

Is this a real leak:

#+begin_src valgrind-leak
==2599359==
==2599359== HEAP SUMMARY:
==2599359==     in use at exit: 11,421 bytes in 78 blocks
==2599359==   total heap usage: 403,744 allocs, 403,666 frees, 161,473,513 bytes allocated
==2599359==
==2599359== 1,944 bytes in 9 blocks are definitely lost in loss record 20 of 21
==2599359==    at 0x4F2B818: malloc (vg_replace_malloc.c:446)
==2599359==    by 0x5AE29FF: PQmakeEmptyPGresult (fe-exec.c:161)
==2599359==    by 0x5AEA9F2: pqParseInput3 (fe-protocol3.c:264)
==2599359==    by 0x5AE5853: parseInput (fe-exec.c:1997)
==2599359==    by 0x5AE5975: PQgetResult (fe-exec.c:2083)
==2599359==    by 0x5AE5FB7: PQexecFinish (fe-exec.c:2388)
==2599359==    by 0x5AE5D98: PQprepare (fe-exec.c:2275)
==2599359==    by 0x5A7F688: sqlgen::postgres::Connection::insert(sqlgen::dynamic::Insert const&, std::vector<std::vector<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > >, std::allocator<std::vector<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > > > > const&) (Connection.cpp:44)
==2599359==    by 0x525189F: sqlgen::Session<sqlgen::postgres::Connection>::insert(sqlgen::dynamic::Insert const&, std::vector<std::vector<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > >, std::allocator<std::vector<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > > > > const&) (Session.hpp:50)
==2599359==    by 0x523F4FF: sqlgen::Transaction<sqlgen::Session<sqlgen::postgres::Connection> >::insert(sqlgen::dynamic::Insert const&, std::vector<std::vector<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > >, std::allocator<std::vector<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > > > > const&) (Transaction.hpp:61)
==2599359==    by 0x523EE20: rfl::Result<rfl::Ref<sqlgen::Transaction<sqlgen::Session<sqlgen::postgres::Connection> > > > sqlgen::insert_impl<__gnu_cxx::__normal_iterator<ores::accounts::repository::account_entity const*, std::vector<ores::accounts::repository::account_entity, std::allocator<ores::accounts::repository::account_entity> > >, __gnu_cxx::__normal_iterator<ores::accounts::repository::account_entity const*, std::vector<ores::accounts::repository::account_entity, std::allocator<ores::accounts::repository::account_entity> > >, sqlgen::Transaction<sqlgen::Session<sqlgen::postgres::Connection> > >(rfl::Ref<sqlgen::Transaction<sqlgen::Session<sqlgen::postgres::Connection> > > const&, __gnu_cxx::__normal_iterator<ores::accounts::repository::account_entity const*, std::vector<ores::accounts::repository::account_entity, std::allocator<ores::accounts::repository::account_entity> > >, __gnu_cxx::__normal_iterator<ores::accounts::repository::account_entity const*, std::vector<ores::accounts::repository::account_entity, std::allocator<ores::accounts::repository::account_entity> > >, bool) requires is_connection<sqlgen::Transaction<sqlgen::Session<sqlgen::postgres::Connection> > > (insert.hpp:46)
==2599359==    by 0x523EB55: auto sqlgen::insert_impl<std::vector<ores::accounts::repository::account_entity, std::allocator<ores::accounts::repository::account_entity> >, rfl::Ref<sqlgen::Transaction<sqlgen::Session<sqlgen::postgres::Connection> > > >(rfl::Ref<sqlgen::Transaction<sqlgen::Session<sqlgen::postgres::Connection> > > const&, std::vector<ores::accounts::repository::account_entity, std::allocator<ores::accounts::repository::account_entity> > const&, bool) (insert.hpp:69)
==2599359==
==2599359== 3,672 bytes in 17 blocks are definitely lost in loss record 21 of 21
==2599359==    at 0x4F2B818: malloc (vg_replace_malloc.c:446)
==2599359==    by 0x5AE29FF: PQmakeEmptyPGresult (fe-exec.c:161)
==2599359==    by 0x5AEA78E: pqParseInput3 (fe-protocol3.c:200)
==2599359==    by 0x5AE5853: parseInput (fe-exec.c:1997)
==2599359==    by 0x5AE5975: PQgetResult (fe-exec.c:2083)
==2599359==    by 0x5AE5FB7: PQexecFinish (fe-exec.c:2388)
==2599359==    by 0x5AE5E15: PQexecPrepared (fe-exec.c:2298)
==2599359==    by 0x5A7FB5B: sqlgen::postgres::Connection::insert(sqlgen::dynamic::Insert const&, std::vector<std::vector<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > >, std::allocator<std::vector<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > > > > const&) (Connection.cpp:72)
==2599359==    by 0x525189F: sqlgen::Session<sqlgen::postgres::Connection>::insert(sqlgen::dynamic::Insert const&, std::vector<std::vector<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > >, std::allocator<std::vector<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > > > > const&) (Session.hpp:50)
==2599359==    by 0x523F4FF: sqlgen::Transaction<sqlgen::Session<sqlgen::postgres::Connection> >::insert(sqlgen::dynamic::Insert const&, std::vector<std::vector<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > >, std::allocator<std::vector<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > >, std::allocator<std::optional<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > > > > const&) (Transaction.hpp:61)
==2599359==    by 0x523EE20: rfl::Result<rfl::Ref<sqlgen::Transaction<sqlgen::Session<sqlgen::postgres::Connection> > > > sqlgen::insert_impl<__gnu_cxx::__normal_iterator<ores::accounts::repository::account_entity const*, std::vector<ores::accounts::repository::account_entity, std::allocator<ores::accounts::repository::account_entity> > >, __gnu_cxx::__normal_iterator<ores::accounts::repository::account_entity const*, std::vector<ores::accounts::repository::account_entity, std::allocator<ores::accounts::repository::account_entity> > >, sqlgen::Transaction<sqlgen::Session<sqlgen::postgres::Connection> > >(rfl::Ref<sqlgen::Transaction<sqlgen::Session<sqlgen::postgres::Connection> > > const&, __gnu_cxx::__normal_iterator<ores::accounts::repository::account_entity const*, std::vector<ores::accounts::repository::account_entity, std::allocator<ores::accounts::repository::account_entity> > >, __gnu_cxx::__normal_iterator<ores::accounts::repository::account_entity const*, std::vector<ores::accounts::repository::account_entity, std::allocator<ores::accounts::repository::account_entity> > >, bool) requires is_connection<sqlgen::Transaction<sqlgen::Session<sqlgen::postgres::Connection> > > (insert.hpp:46)
==2599359==    by 0x523EB55: auto sqlgen::insert_impl<std::vector<ores::accounts::repository::account_entity, std::allocator<ores::accounts::repository::account_entity> >, rfl::Ref<sqlgen::Transaction<sqlgen::Session<sqlgen::postgres::Connection> > > >(rfl::Ref<sqlgen::Transaction<sqlgen::Session<sqlgen::postgres::Connection> > > const&, std::vector<ores::accounts::repository::account_entity, std::allocator<ores::accounts::repository::account_entity> > const&, bool) (insert.hpp:69)
==2599359==
==2599359== LEAK SUMMARY:
==2599359==    definitely lost: 5,616 bytes in 26 blocks
==2599359==    indirectly lost: 0 bytes in 0 blocks
==2599359==      possibly lost: 0 bytes in 0 blocks
==2599359==    still reachable: 5,805 bytes in 52 blocks
==2599359==         suppressed: 0 bytes in 0 blocks
==2599359== Reachable blocks (those to which a pointer was found) are not shown.
==2599359== To see them, rerun with: --leak-check=full --show-leak-kinds=all
==2599359==
==2599359== For lists of detected and suppressed errors, rerun with: -s
==2599359== ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 0 from 0)
#+end_src



*** Footer

| Previous: [[id:154212FF-BB02-8D84-1E33-9338B458380A][Version Zero]] |
